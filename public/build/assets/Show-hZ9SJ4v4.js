import{_ as W}from"./createLucideIcon-C3Ab61m5.js";import{t as T,d as Y,_ as C,a as w,b as k,c as E}from"./index-Cmp74z6d.js";import{_ as P}from"./CardDescription.vue_vue_type_script_setup_true_lang-CiKhemwU.js";import{e as I,C as ee}from"./DialogTitle.vue_vue_type_script_setup_true_lang-B5BWniUE.js";import{_ as te,a as se,b as Z,c as J}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-CBeIuRfb.js";import{d as K,c as ae,M as oe,B as re,b as le,_ as ie}from"./AppLayout.vue_vue_type_script_setup_true_lang-CyoQlVBv.js";import{d as q,k as D,s as ne,a as x,o as _,f as s,b as e,u as t,e as a,g as c,F as z,r as M,v as N,t as f,j as de,i as ue,q as Q,p as ce,w as fe,y as me,m as pe,P as X}from"./app-7LlKm78u.js";import{_ as ve}from"./Checkbox.vue_vue_type_script_setup_true_lang-B8XkLU9h.js";import{_ as ge,a as _e,b as G,c as H,d as be,e as O}from"./TableHeader.vue_vue_type_script_setup_true_lang-4AxO5XkK.js";import{C as V,r as xe}from"./chart-BrhGNDWt.js";import{A as $e}from"./arrow-left-Mds2BBut.js";import{S as ye}from"./square-pen-avcIrZfD.js";import{H as he}from"./house-kmR2zO7l.js";import{U as Ce}from"./user-DvDj7gu6.js";import"./VisuallyHidden-BQiVCHMw.js";import"./Label.vue_vue_type_script_setup_true_lang-CNdlZ2bU.js";import"./index-BLTdg2QY.js";import"./RovingFocusItem-DNo-Fgu5.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Cne8tvjX.js";const we={class:"w-full overflow-x-auto"},ke={class:"min-w-[800px]"},Ee={class:"flex items-center justify-between"},ze={class:"text-sm"},Ne={key:0,class:"ml-2 h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"},Me={class:"flex justify-center"},je={class:"mt-6 p-4 bg-gray-50 rounded-lg"},Re={class:"grid grid-cols-1 md:grid-cols-5 gap-3"},Ae={class:"font-medium"},Le=q({__name:"MatrizMadurez",props:{reporteId:{},categorias:{},evaluacionesExistentes:{},niveles:{}},emits:["evaluacionChanged"],setup(j,{emit:g}){const p=j,v=D(null),b=ne({...p.evaluacionesExistentes}),h=g,$=["emergente","resolutivo","laborioso","cooperativo","progresivo"],R=o=>{const d=o.replace("#",""),i=parseInt(d.substr(0,2),16),r=parseInt(d.substr(2,2),16),m=parseInt(d.substr(4,2),16);return`rgba(${i}, ${r}, ${m}, 0.15)`},A=o=>"#374151",L=(o,d)=>{const i=b[o];return(i==null?void 0:i.nivel)===d},l=async(o,d,i)=>{v.value=o;try{i?(b[o]={id:Date.now(),elemento_id:o,nivel:d,reporte_id:p.reporteId},(await Q.post(`/admin/reportes-madurez/${p.reporteId}/evaluacion`,{elemento_id:o,nivel:d})).data.success&&(T.success("Evaluación guardada correctamente"),h("evaluacionChanged",o,d))):(delete b[o],(await Q.post(`/admin/reportes-madurez/${p.reporteId}/remove-evaluacion`,{elemento_id:o})).data.success&&(T.success("Evaluación eliminada correctamente"),h("evaluacionChanged",o,null)))}catch(r){if(console.error("Error al guardar evaluación:",r),T.error("Error al guardar la evaluación"),i)delete b[o];else{const m=p.evaluacionesExistentes[o];m&&(b[o]=m)}}finally{v.value=null}},n=o=>({emergente:"#dc2626",resolutivo:"#ea580c",laborioso:"#ca8a04",cooperativo:"#2563eb",progresivo:"#16a34a"})[o]||"#6b7280",u=o=>({emergente:"#fef2f2",resolutivo:"#fff7ed",laborioso:"#fefce8",cooperativo:"#eff6ff",progresivo:"#f0fdf4"})[o]||"#f9fafb";return(o,d)=>(_(),x("div",we,[s("div",ke,[e(t(ge),{class:"border-collapse border border-gray-300"},{default:a(()=>[e(t(_e),null,{default:a(()=>[e(t(G),{class:"bg-gray-50"},{default:a(()=>[e(t(H),{class:"border border-gray-300 w-8 text-center font-bold bg-gray-100"},{default:a(()=>d[0]||(d[0]=[c(" No. ")])),_:1}),e(t(H),{class:"border border-gray-300 min-w-[300px] font-bold bg-gray-100"},{default:a(()=>d[1]||(d[1]=[c(" ELEMENTO ")])),_:1}),(_(),x(z,null,M($,i=>e(t(H),{key:i,class:"border border-gray-300 w-24 text-center font-bold text-xs p-2 rotate-0",style:N({backgroundColor:u(i),color:n(i)})},{default:a(()=>[c(f(p.niveles[i]||i.toUpperCase()),1)]),_:2},1032,["style"])),64))]),_:1})]),_:1}),e(t(be),null,{default:a(()=>[(_(!0),x(z,null,M(o.categorias,i=>(_(),x(z,{key:i.id},[e(t(G),null,{default:a(()=>[e(t(O),{colspan:7,class:"border border-gray-300 p-3 font-bold text-center text-sm",style:N({backgroundColor:R(i.color),color:A(i.color),borderLeft:`4px solid ${i.color}`})},{default:a(()=>[c(f(i.nombre),1)]),_:2},1032,["style"])]),_:2},1024),(_(!0),x(z,null,M(i.elementos,r=>(_(),de(t(G),{key:r.id,class:"hover:bg-gray-50"},{default:a(()=>[e(t(O),{class:"border border-gray-300 text-center font-medium bg-gray-50"},{default:a(()=>[c(f(r.numero),1)]),_:2},1024),e(t(O),{class:"border border-gray-300 p-3"},{default:a(()=>[s("div",Ee,[s("span",ze,f(r.nombre),1),v.value===r.id?(_(),x("div",Ne)):ue("",!0)])]),_:2},1024),(_(),x(z,null,M($,m=>e(t(O),{key:`${r.id}-${m}`,class:"border border-gray-300 text-center p-2"},{default:a(()=>[s("div",Me,[e(t(ve),{id:`elemento-${r.id}-${m}`,checked:L(r.id,m),disabled:v.value===r.id,"onUpdate:checked":y=>l(r.id,m,y),class:"h-5 w-5"},null,8,["id","checked","disabled","onUpdate:checked"])])]),_:2},1024)),64))]),_:2},1024))),128))],64))),128))]),_:1})]),_:1})]),s("div",je,[d[2]||(d[2]=s("h4",{class:"text-sm font-medium mb-3"},"Leyenda de Niveles de Madurez:",-1)),s("div",Re,[(_(),x(z,null,M($,i=>s("div",{key:i,class:"flex items-center gap-2 p-2 rounded text-xs",style:N({backgroundColor:u(i),color:n(i)})},[s("div",{class:"w-3 h-3 rounded-full",style:N({backgroundColor:n(i)})},null,4),s("span",Ae,f(p.niveles[i]||i.toUpperCase()),1)],4)),64))])]),d[3]||(d[3]=s("div",{class:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200"},[s("h4",{class:"text-sm font-medium text-blue-900 mb-2"},"Instrucciones:"),s("ul",{class:"text-xs text-blue-800 space-y-1"},[s("li",null,"• Selecciona un solo nivel de madurez por cada elemento"),s("li",null,"• Al marcar un checkbox, se desmarcará automáticamente cualquier nivel previamente seleccionado"),s("li",null,"• Los cambios se guardan automáticamente"),s("li",null,"• Puedes desmarcar un checkbox para eliminar la evaluación de ese elemento")])],-1))]))}}),Se=Y(Le,[["__scopeId","data-v-ab873f08"]]),Be={class:"space-y-6"},De={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Oe={class:"text-2xl font-bold"},Pe={class:"text-xs text-muted-foreground"},Ue={class:"text-2xl font-bold"},Fe={class:"text-2xl font-bold"},Te={class:"w-full bg-gray-200 rounded-full h-2 mb-2"},Ge={class:"text-xs text-muted-foreground"},He={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Ve={class:"h-64 flex items-center justify-center"},qe={class:"h-80 flex items-center justify-center"},We={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4"},Ze={class:"font-medium text-sm mb-1"},Je=q({__name:"EstadisticasMadurez",props:{estadisticas:{},niveles:{}},setup(j){V.register(...xe);const g=j,p=D(null),v=D(null);let b=null,h=null;const $={emergente:"#dc2626",resolutivo:"#ea580c",laborioso:"#ca8a04",cooperativo:"#2563eb",progresivo:"#16a34a"},R=u=>u==null||u===0?"0%":u===100?"100%":`${u.toFixed(1)}%`,A=()=>{if(!p.value)return;const u=Object.entries(g.estadisticas.por_nivel),o=u.map(([r])=>g.niveles[r]||r),d=u.map(([,r])=>r),i=u.map(([r])=>$[r]||"#6b7280");b=new V(p.value,{type:"doughnut",data:{labels:o,datasets:[{data:d,backgroundColor:i,borderColor:i,borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:r=>{const m=r.label||"",y=r.parsed,S=d.reduce((F,B)=>F+B,0),U=S>0?(y/S*100).toFixed(1):"0";return`${m}: ${y} elementos (${U}%)`}}}}}})},L=()=>{if(!v.value)return;const u=Object.entries(g.estadisticas.por_categoria),o=u.map(([,r])=>r.nombre),d={emergente:"#dc2626",resolutivo:"#ea580c",laborioso:"#ca8a04",cooperativo:"#2563eb",progresivo:"#16a34a"},i=Object.keys(d).map(r=>({label:g.niveles[r]||r.toUpperCase(),data:u.map(([,m])=>{var y;return((y=m.distribucion_niveles)==null?void 0:y[r])||0}),backgroundColor:d[r],borderColor:d[r],borderWidth:1}));h=new V(v.value,{type:"bar",data:{labels:o,datasets:i},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0,ticks:{stepSize:1,callback:r=>Math.floor(r)===r?r:""}}},plugins:{legend:{position:"top"},tooltip:{mode:"index",intersect:!1,callbacks:{title:r=>`Categoría: ${r[0].label}`,label:r=>{const m=r.parsed.y;return`${r.dataset.label}: ${m} elemento${m!==1?"s":""}`}}}}}})},l=()=>{b&&(b.destroy(),b=null),h&&(h.destroy(),h=null)},n=()=>{l(),setTimeout(()=>{A(),L()},100)};return ce(()=>{n()}),fe(()=>g.estadisticas,()=>{n()},{deep:!0}),me(()=>{l()}),(u,o)=>(_(),x("div",Be,[s("div",De,[e(t(C),null,{default:a(()=>[e(t(w),{class:"pb-3"},{default:a(()=>[e(t(k),{class:"text-sm font-medium"},{default:a(()=>o[0]||(o[0]=[c("Total Evaluado")])),_:1})]),_:1}),e(t(E),null,{default:a(()=>[s("div",Oe,f(u.estadisticas.total_evaluado),1),s("p",Pe," de "+f(u.estadisticas.total_elementos)+" elementos ",1)]),_:1})]),_:1}),e(t(C),null,{default:a(()=>[e(t(w),{class:"pb-3"},{default:a(()=>[e(t(k),{class:"text-sm font-medium"},{default:a(()=>o[1]||(o[1]=[c("Completitud General")])),_:1})]),_:1}),e(t(E),null,{default:a(()=>[s("div",Ue,f(R(u.estadisticas.porcentaje_completitud)),1),o[2]||(o[2]=s("p",{class:"text-xs text-muted-foreground"},"del reporte",-1))]),_:1})]),_:1}),e(t(C),null,{default:a(()=>[e(t(w),{class:"pb-3"},{default:a(()=>[e(t(k),{class:"text-sm font-medium"},{default:a(()=>o[3]||(o[3]=[c("Categorías")])),_:1})]),_:1}),e(t(E),null,{default:a(()=>[s("div",Fe,f(Object.keys(u.estadisticas.por_categoria).length),1),o[4]||(o[4]=s("p",{class:"text-xs text-muted-foreground"},"evaluadas",-1))]),_:1})]),_:1}),e(t(C),null,{default:a(()=>[e(t(w),{class:"pb-3"},{default:a(()=>[e(t(k),{class:"text-sm font-medium"},{default:a(()=>o[5]||(o[5]=[c("Progreso")])),_:1})]),_:1}),e(t(E),null,{default:a(()=>[s("div",Te,[s("div",{class:"bg-primary h-2 rounded-full transition-all duration-300",style:N({width:`${u.estadisticas.porcentaje_completitud}%`})},null,4)]),s("p",Ge,f(u.estadisticas.total_evaluado)+" / "+f(u.estadisticas.total_elementos),1)]),_:1})]),_:1})]),s("div",He,[e(t(C),null,{default:a(()=>[e(t(w),null,{default:a(()=>[e(t(k),null,{default:a(()=>o[6]||(o[6]=[c("Distribución por Nivel de Madurez")])),_:1}),e(t(P),null,{default:a(()=>o[7]||(o[7]=[c(" Cantidad de elementos evaluados en cada nivel ")])),_:1})]),_:1}),e(t(E),null,{default:a(()=>[s("div",Ve,[s("canvas",{ref_key:"chartNivelesRef",ref:p,class:"max-h-full max-w-full"},null,512)])]),_:1})]),_:1}),e(t(C),null,{default:a(()=>[e(t(w),null,{default:a(()=>[e(t(k),null,{default:a(()=>o[8]||(o[8]=[c("Distribución de Niveles por Categoría")])),_:1}),e(t(P),null,{default:a(()=>o[9]||(o[9]=[c(" Cantidad de elementos en cada nivel de madurez por categoría ")])),_:1})]),_:1}),e(t(E),null,{default:a(()=>[s("div",qe,[s("canvas",{ref_key:"chartCategoriasRef",ref:v,class:"max-h-full max-w-full"},null,512)])]),_:1})]),_:1})]),e(t(C),null,{default:a(()=>[e(t(w),null,{default:a(()=>[e(t(k),null,{default:a(()=>o[10]||(o[10]=[c("Distribución Detallada por Niveles")])),_:1}),e(t(P),null,{default:a(()=>o[11]||(o[11]=[c(" Cantidad exacta de elementos en cada nivel de madurez ")])),_:1})]),_:1}),e(t(E),null,{default:a(()=>[s("div",We,[(_(!0),x(z,null,M(u.estadisticas.por_nivel,(d,i)=>(_(),x("div",{key:i,class:"p-4 rounded-lg border text-center",style:N({backgroundColor:`${$[i]||"#6b7280"}15`,borderColor:$[i]||"#6b7280"})},[s("div",{class:"w-8 h-8 rounded-full mx-auto mb-2",style:N({backgroundColor:$[i]||"#6b7280"})},null,4),s("h4",Ze,f(u.niveles[i]||i),1),s("div",{class:"text-2xl font-bold",style:N({color:$[i]||"#6b7280"})},f(d),5),o[12]||(o[12]=s("p",{class:"text-xs text-muted-foreground"},"elementos",-1))],4))),128))])]),_:1})]),_:1})]))}}),Ke={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Qe={class:"flex items-center justify-between"},Xe={class:"flex items-center gap-4"},Ye={class:"text-sm text-muted-foreground"},Ie={class:"flex items-center gap-2"},et={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},tt={class:"flex items-center gap-2"},st={class:"text-sm text-muted-foreground"},at={class:"flex items-center gap-2"},ot={class:"text-sm text-muted-foreground"},rt={class:"flex items-center gap-2"},lt={class:"text-sm text-muted-foreground"},it={class:"flex items-center gap-2"},nt={class:"text-sm text-muted-foreground"},dt={class:"flex items-center gap-2"},ut={class:"text-sm text-muted-foreground"},ct={class:"flex items-center gap-2"},ft={class:"text-sm text-muted-foreground"},At=q({__name:"Show",props:{reporte:{},categorias:{},evaluacionesExistentes:{},estadisticas:{},niveles:{}},setup(j){const g=j,p=D({...g.evaluacionesExistentes}),v=D({...g.estadisticas}),b=(l,n)=>{n?p.value[l]={id:Date.now(),elemento_id:l,nivel:n,reporte_id:g.reporte.id}:delete p.value[l],h()},h=()=>{const l=Object.values(p.value),n=l.length,u=v.value.total_elementos,o={emergente:0,resolutivo:0,laborioso:0,cooperativo:0,progresivo:0};l.forEach(r=>{o[r.nivel]!==void 0&&o[r.nivel]++});const d={...v.value.por_categoria};Object.keys(d).forEach(r=>{d[r].distribucion_niveles={emergente:0,resolutivo:0,laborioso:0,cooperativo:0,progresivo:0},d[r].elementos_evaluados=0}),g.categorias.forEach(r=>{let m=0;const y={emergente:0,resolutivo:0,laborioso:0,cooperativo:0,progresivo:0};r.elementos.forEach(F=>{const B=p.value[F.id];B&&y[B.nivel]!==void 0&&(y[B.nivel]++,m++)});const S=r.elementos.length,U=S>0?m/S*100:0;d[r.codigo]&&(d[r.codigo]={...d[r.codigo],elementos_evaluados:m,porcentaje:U,distribucion_niveles:y})});const i=u>0?n/u*100:0;v.value={...v.value,por_nivel:o,por_categoria:d,total_evaluado:n,porcentaje_completitud:i}},$=[{title:"Admin",href:"/admin/dashboard"},{title:"Reportes de Madurez",href:"/admin/reportes-madurez"},{title:`${g.reporte.empresa} - ${g.reporte.area}`,href:`/admin/reportes-madurez/${g.reporte.id}`}],R=l=>new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),A=l=>l==null||l===0?"0%":l===100?"100%":`${l.toFixed(1)}%`,L=l=>l==null||l===0||l<30?"destructive":l<70?"default":l<100?"secondary":"default";return(l,n)=>(_(),x(z,null,[e(t(pe),{title:`Reporte de Madurez - ${l.reporte.empresa}`},null,8,["title"]),e(ie,{breadcrumbs:$},{default:a(()=>[s("div",Ke,[s("div",Qe,[s("div",Xe,[e(t(X),{href:l.route("admin.reportes-madurez.index")},{default:a(()=>[e(t(W),{variant:"ghost",size:"sm"},{default:a(()=>[e(t($e),{class:"h-4 w-4"})]),_:1})]),_:1},8,["href"]),s("div",null,[n[0]||(n[0]=s("h1",{class:"text-2xl font-semibold"},"Reporte de Madurez",-1)),s("p",Ye,f(l.reporte.empresa)+" - "+f(l.reporte.area),1)])]),s("div",Ie,[e(t(I),{variant:L(v.value.porcentaje_completitud)},{default:a(()=>[c(f(A(v.value.porcentaje_completitud))+" completado ",1)]),_:1},8,["variant"]),e(t(X),{href:l.route("admin.reportes-madurez.edit",l.reporte.id)},{default:a(()=>[e(t(W),{variant:"outline",size:"sm"},{default:a(()=>[e(t(ye),{class:"mr-2 h-4 w-4"}),n[1]||(n[1]=c(" Editar "))]),_:1})]),_:1},8,["href"])])]),e(t(C),null,{default:a(()=>[e(t(w),null,{default:a(()=>[e(t(k),{class:"flex items-center gap-2"},{default:a(()=>[e(t(K),{class:"h-5 w-5"}),n[2]||(n[2]=c(" Información del Reporte "))]),_:1})]),_:1}),e(t(E),null,{default:a(()=>[s("div",et,[s("div",tt,[e(t(ae),{class:"h-4 w-4 text-muted-foreground"}),s("div",null,[n[3]||(n[3]=s("p",{class:"text-sm font-medium"},"Empresa",-1)),s("p",st,f(l.reporte.empresa),1)])]),s("div",at,[e(t(oe),{class:"h-4 w-4 text-muted-foreground"}),s("div",null,[n[4]||(n[4]=s("p",{class:"text-sm font-medium"},"Ciudad",-1)),s("p",ot,f(l.reporte.ciudad),1)])]),s("div",rt,[e(t(he),{class:"h-4 w-4 text-muted-foreground"}),s("div",null,[n[5]||(n[5]=s("p",{class:"text-sm font-medium"},"Centro de Trabajo",-1)),s("p",lt,f(l.reporte.centro_trabajo),1)])]),s("div",it,[e(t(re),{class:"h-4 w-4 text-muted-foreground"}),s("div",null,[n[6]||(n[6]=s("p",{class:"text-sm font-medium"},"Área",-1)),s("p",nt,f(l.reporte.area),1)])]),s("div",dt,[e(t(ee),{class:"h-4 w-4 text-muted-foreground"}),s("div",null,[n[7]||(n[7]=s("p",{class:"text-sm font-medium"},"Fecha de Realización",-1)),s("p",ut,f(R(l.reporte.fecha_realizacion)),1)])]),s("div",ct,[e(t(Ce),{class:"h-4 w-4 text-muted-foreground"}),s("div",null,[n[8]||(n[8]=s("p",{class:"text-sm font-medium"},"Creado por",-1)),s("p",ft,f(l.reporte.creador.name),1)])])])]),_:1})]),_:1}),e(t(te),{"default-value":"evaluacion",class:"flex-1"},{default:a(()=>[e(t(se),{class:"grid w-full grid-cols-2"},{default:a(()=>[e(t(Z),{value:"evaluacion",class:"flex items-center gap-2"},{default:a(()=>[e(t(K),{class:"h-4 w-4"}),n[9]||(n[9]=c(" Evaluación "))]),_:1}),e(t(Z),{value:"estadisticas",class:"flex items-center gap-2"},{default:a(()=>[e(t(le),{class:"h-4 w-4"}),n[10]||(n[10]=c(" Estadísticas "))]),_:1})]),_:1}),e(t(J),{value:"evaluacion",class:"space-y-4"},{default:a(()=>[e(t(C),null,{default:a(()=>[e(t(w),null,{default:a(()=>[e(t(k),null,{default:a(()=>n[11]||(n[11]=[c("Matriz de Evaluación de Madurez")])),_:1}),e(t(P),null,{default:a(()=>n[12]||(n[12]=[c(" Marca el nivel de madurez correspondiente para cada elemento. Solo se puede seleccionar un nivel por elemento. ")])),_:1})]),_:1}),e(t(E),null,{default:a(()=>[e(Se,{"reporte-id":l.reporte.id,categorias:l.categorias,"evaluaciones-existentes":p.value,niveles:l.niveles,onEvaluacionChanged:b},null,8,["reporte-id","categorias","evaluaciones-existentes","niveles"])]),_:1})]),_:1})]),_:1}),e(t(J),{value:"estadisticas",class:"space-y-4"},{default:a(()=>[e(Je,{estadisticas:v.value,niveles:l.niveles},null,8,["estadisticas","niveles"])]),_:1})]),_:1})])]),_:1})],64))}});export{At as default};
