import{d as J,k as m,w as q,p as X,x as le,a as c,o as d,v as Y,b as t,u as e,m as ne,e as s,f as l,t as u,g as n,i as v,F as C,r as j,j as R,z as ie,W as re}from"./app-DxMxyGIi.js";import{e as G,C as de,U as ue,_ as ce,a as fe,b as _e,c as me,d as M}from"./DialogTitle.vue_vue_type_script_setup_true_lang-keujMKwJ.js";import{c as pe,_ as D}from"./createLucideIcon-xPfym20I.js";import{d as ve,_ as B,c as A,a as F,b as L}from"./index-v0X4dJtb.js";import{a as ge}from"./Label.vue_vue_type_script_setup_true_lang-ZtqQUjfr.js";import{_ as be,a as he,b as N,c as U}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-DzedtnD6.js";import{_ as K,a as Q,b as z,c as y,d as Z,e as k}from"./TableHeader.vue_vue_type_script_setup_true_lang-BTf4uMaO.js";import{C as ye,c as ke,d as xe,e as we,f as $e,p as Ce,a as Ve}from"./chart-BrhGNDWt.js";import{B as Te}from"./index-BWdzSf1C.js";import{b as Pe,e as je,_ as De}from"./AppLayout.vue_vue_type_script_setup_true_lang-DbJ5w6pd.js";import{A as Re}from"./arrow-left-D9MtFtFW.js";import{E as Be}from"./external-link-BaKyQRQS.js";import"./VisuallyHidden-BBnR0lPC.js";import"./index-jh-0-z8Q.js";import"./RovingFocusItem-C8QE-sTg.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-BQ8AGSZc.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=pe("GlobeIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),Ae=J({__name:"BarChart",props:{data:{},title:{default:""},height:{default:400},showPercentage:{type:Boolean,default:!1}},setup(S,{expose:h}){ye.register(ke,xe,we,$e,Ce,Ve);const f=S,V=m(),x=m({labels:[],datasets:[]}),T=m({responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!!f.title,text:f.title,font:{size:16,weight:"bold"}},legend:{display:!1},tooltip:{callbacks:{label:function(i){const _=i.parsed.y;return f.showPercentage?`${i.label}: ${_}%`:`${i.label}: ${_} votos`}}}},scales:{x:{title:{display:!0,text:"Opciones"},ticks:{maxRotation:45,minRotation:0}},y:{beginAtZero:!0,title:{display:!0,text:f.showPercentage?"Porcentaje (%)":"Número de votos"},ticks:{callback:function(i){return f.showPercentage?i+"%":i}}}},animation:{duration:1e3,easing:"easeInOutQuart"}}),g=()=>{!f.data||!f.data.labels||!f.data.datasets||(x.value={labels:f.data.labels,datasets:f.data.datasets.map(i=>({...i,backgroundColor:i.backgroundColor||["rgba(54, 162, 235, 0.8)","rgba(255, 99, 132, 0.8)","rgba(255, 205, 86, 0.8)","rgba(75, 192, 192, 0.8)","rgba(153, 102, 255, 0.8)","rgba(255, 159, 64, 0.8)","rgba(199, 199, 199, 0.8)","rgba(83, 102, 255, 0.8)","rgba(255, 99, 255, 0.8)","rgba(255, 159, 10, 0.8)"].slice(0,f.data.labels.length),borderColor:i.borderColor||["rgba(54, 162, 235, 1)","rgba(255, 99, 132, 1)","rgba(255, 205, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)","rgba(199, 199, 199, 1)","rgba(83, 102, 255, 1)","rgba(255, 99, 255, 1)","rgba(255, 159, 10, 1)"].slice(0,f.data.labels.length),borderWidth:i.borderWidth||1}))})},w=i=>{const _=i.map(p=>p.opcion),$=i.map(p=>f.showPercentage?p.porcentaje:p.cantidad);return{labels:_,datasets:[{label:f.showPercentage?"Porcentaje":"Votos",data:$}]}};return q(()=>f.data,()=>{g()},{deep:!0}),q(()=>f.showPercentage,()=>{g()}),X(()=>{le(()=>{g()})}),h({getChartDataFromResponses:w}),(i,_)=>(d(),c("div",{class:"w-full",style:Y({height:`${i.height}px`})},[t(e(Te),{ref_key:"chartRef",ref:V,data:x.value,options:T.value},null,8,["data","options"])],4))}}),ze=ve(Ae,[["__scopeId","data-v-0e3b78a4"]]),Se={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ee={class:"flex items-center justify-between"},Ie={class:"text-muted-foreground"},Me={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},Fe={class:"flex items-center gap-2"},Le={class:"flex items-center gap-2 text-sm text-muted-foreground"},Ne={class:"flex items-center gap-2 text-sm"},Ue={class:"font-medium"},We={key:0,class:"flex items-center gap-2 text-sm text-muted-foreground"},Oe={key:0,class:"text-sm text-muted-foreground mt-3"},qe={key:0,class:"text-center py-8"},Ge={key:1,class:"space-y-6"},Ke={class:"text-lg font-semibold"},Qe={class:"text-sm text-muted-foreground"},Ze={key:0,class:"space-y-4"},He={class:"bg-card border rounded-lg p-4"},Je={class:"space-y-2"},Xe={class:"flex-1"},Ye={class:"flex items-center justify-between mb-1"},et={class:"font-medium"},tt={class:"text-sm text-muted-foreground"},at={class:"w-full bg-muted rounded-full h-2"},st={key:1,class:"space-y-2"},ot={class:"max-h-64 overflow-y-auto space-y-2"},lt={key:0,class:"text-xs text-muted-foreground"},nt={class:"flex items-center justify-between"},it={key:0,class:"text-center py-8"},rt={key:1,class:"space-y-4"},dt={class:"rounded-md border"},ut={class:"text-sm text-muted-foreground"},ct={class:"flex items-center justify-between"},ft={class:"flex gap-2"},_t={key:0,class:"text-center py-8"},mt={key:1,class:"space-y-4"},pt={class:"rounded-md border"},vt={key:0,class:"flex items-center justify-between"},gt={class:"text-sm text-muted-foreground"},bt={class:"flex gap-2"},St=J({__name:"Resultados",props:{votacion:{},user:{}},setup(S){const h=S,f=h.user.es_admin?[{title:"Admin",href:"/admin/dashboard"},{title:"Votaciones",href:"/admin/votaciones"},{title:"Resultados",href:"#"}]:[{title:"Dashboard",href:"/dashboard"},{title:"Mis Votaciones",href:"/votaciones"},{title:"Resultados",href:"#"}],V=m(!1),x=m(!1),T=m(!1),g=m(null),w=m(null),i=m(null),_=m("territorio"),$=m(""),p=m(1),ee=()=>{re.get(h.user.es_admin?"/admin/votaciones":"/votaciones")},te=r=>{const a=`/verificar-token/${r}`;window.open(a,"_blank")},W=async()=>{V.value=!0;try{const a=await(await fetch(`/api/votaciones/${h.votacion.id}/resultados/consolidado`)).json();g.value=a}catch(r){console.error("Error cargando datos consolidados:",r)}finally{V.value=!1}},E=async()=>{x.value=!0;try{const a=await(await fetch(`/api/votaciones/${h.votacion.id}/resultados/territorio?agrupacion=${_.value}`)).json();w.value=a}catch(r){console.error("Error cargando datos de territorio:",r)}finally{x.value=!1}},P=async()=>{T.value=!0;try{let r=`/api/votaciones/${h.votacion.id}/resultados/tokens?page=${p.value}`;$.value&&(r+=`&busqueda=${encodeURIComponent($.value)}`);const o=await(await fetch(r)).json();i.value=o}catch(r){console.error("Error cargando tokens:",r)}finally{T.value=!1}},I=r=>new Date(r).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),ae=()=>{E()},O=()=>{p.value=1,P()},se=r=>({labels:r.map(a=>a.opcion),datasets:[{label:"Votos",data:r.map(a=>a.cantidad)}]});return X(()=>{W(),E(),P()}),(r,a)=>(d(),c(C,null,[t(e(ne),{title:`Resultados: ${r.votacion.titulo}`},null,8,["title"]),t(De,{breadcrumbs:e(f)},{default:s(()=>[l("div",Se,[l("div",Ee,[l("div",null,[a[4]||(a[4]=l("h1",{class:"text-3xl font-bold"},"Resultados de Votación",-1)),l("p",Ie,u(r.votacion.titulo),1)]),t(e(D),{onClick:ee,variant:"outline"},{default:s(()=>[t(e(Re),{class:"mr-2 h-4 w-4"}),a[5]||(a[5]=n(" Volver "))]),_:1})]),t(e(B),null,{default:s(()=>[t(e(A),{class:"pt-6"},{default:s(()=>[l("div",Me,[l("div",Fe,[t(e(G),{variant:"outline"},{default:s(()=>[n(u(r.votacion.categoria.nombre),1)]),_:1})]),l("div",Le,[t(e(de),{class:"h-4 w-4"}),n(" Finalizó: "+u(I(r.votacion.fecha_fin)),1)]),l("div",Ne,[t(e(ue),{class:"h-4 w-4 text-blue-600"}),l("span",Ue,u(r.votacion.total_votos)+" votos",1)]),r.votacion.fecha_publicacion_resultados?(d(),c("div",We,[t(e(H),{class:"h-4 w-4"}),n(" Publicado: "+u(I(r.votacion.fecha_publicacion_resultados)),1)])):v("",!0)]),r.votacion.descripcion?(d(),c("p",Oe,u(r.votacion.descripcion),1)):v("",!0)]),_:1})]),_:1}),t(e(be),{"default-value":"consolidado",class:"flex-1"},{default:s(()=>[t(e(he),{class:"grid w-full grid-cols-3"},{default:s(()=>[t(e(N),{value:"consolidado",onClick:W},{default:s(()=>[t(e(Pe),{class:"mr-2 h-4 w-4"}),a[6]||(a[6]=n(" Consolidado "))]),_:1}),t(e(N),{value:"territorio",onClick:E},{default:s(()=>[t(e(H),{class:"mr-2 h-4 w-4"}),a[7]||(a[7]=n(" Por Territorio "))]),_:1}),t(e(N),{value:"tokens",onClick:P},{default:s(()=>[t(e(je),{class:"mr-2 h-4 w-4"}),a[8]||(a[8]=n(" Tokens Públicos "))]),_:1})]),_:1}),t(e(U),{value:"consolidado",class:"space-y-4"},{default:s(()=>[t(e(B),null,{default:s(()=>[t(e(F),null,{default:s(()=>[t(e(L),null,{default:s(()=>a[9]||(a[9]=[n("Resultados Consolidados por Pregunta")])),_:1})]),_:1}),t(e(A),null,{default:s(()=>[V.value?(d(),c("div",qe," Cargando resultados... ")):g.value?(d(),c("div",Ge,[(d(!0),c(C,null,j(g.value.resultados,o=>(d(),c("div",{key:o.id,class:"space-y-4"},[l("div",null,[l("h3",Ke,u(o.titulo),1),l("p",Qe,u(o.total_respuestas)+" respuestas de "+u(g.value.total_votos)+" votos totales ",1)]),o.tipo!=="text"&&o.tipo!=="textarea"?(d(),c("div",Ze,[l("div",He,[t(ze,{data:se(o.respuestas),title:`Distribución de respuestas: ${o.titulo}`,height:300},null,8,["data","title"])]),l("div",Je,[(d(!0),c(C,null,j(o.respuestas,b=>(d(),c("div",{key:b.opcion,class:"flex items-center justify-between p-3 bg-muted/30 rounded-lg"},[l("div",Xe,[l("div",Ye,[l("span",et,u(b.opcion),1),l("span",tt,u(b.cantidad)+" ("+u(b.porcentaje)+"%) ",1)]),l("div",at,[l("div",{class:"bg-primary h-2 rounded-full transition-all duration-300",style:Y({width:`${b.porcentaje}%`})},null,4)])])]))),128))])])):(d(),c("div",st,[l("div",ot,[(d(!0),c(C,null,j(o.respuestas.slice(0,10),(b,oe)=>(d(),c("div",{key:oe,class:"p-2 bg-muted/30 rounded text-sm"},u(b),1))),128))]),o.respuestas.length>10?(d(),c("p",lt," Mostrando 10 de "+u(o.respuestas.length)+" respuestas ",1)):v("",!0)]))]))),128))])):v("",!0)]),_:1})]),_:1})]),_:1}),t(e(U),{value:"territorio",class:"space-y-4"},{default:s(()=>[t(e(B),null,{default:s(()=>[t(e(F),null,{default:s(()=>[l("div",nt,[t(e(L),null,{default:s(()=>a[10]||(a[10]=[n("Resultados por Territorio")])),_:1}),t(e(ce),{modelValue:_.value,"onUpdate:modelValue":[a[0]||(a[0]=o=>_.value=o),ae]},{default:s(()=>[t(e(fe),{class:"w-48"},{default:s(()=>[t(e(_e))]),_:1}),t(e(me),null,{default:s(()=>[t(e(M),{value:"territorio"},{default:s(()=>a[11]||(a[11]=[n("Por Territorio")])),_:1}),t(e(M),{value:"departamento"},{default:s(()=>a[12]||(a[12]=[n("Por Departamento")])),_:1}),t(e(M),{value:"municipio"},{default:s(()=>a[13]||(a[13]=[n("Por Municipio")])),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1}),t(e(A),null,{default:s(()=>[x.value?(d(),c("div",it," Cargando datos territoriales... ")):w.value?(d(),c("div",rt,[l("div",dt,[t(e(K),null,{default:s(()=>[t(e(Q),null,{default:s(()=>[t(e(z),null,{default:s(()=>[t(e(y),null,{default:s(()=>[n(u(_.value==="territorio"?"Territorio":_.value==="departamento"?"Departamento":"Municipio")+" ID",1)]),_:1}),_.value==="municipio"?(d(),R(e(y),{key:0},{default:s(()=>a[14]||(a[14]=[n("Departamento ID")])),_:1})):v("",!0),t(e(y),{class:"text-right"},{default:s(()=>a[15]||(a[15]=[n("Votos")])),_:1}),t(e(y),{class:"text-right"},{default:s(()=>a[16]||(a[16]=[n("Porcentaje")])),_:1})]),_:1})]),_:1}),t(e(Z),null,{default:s(()=>[(d(!0),c(C,null,j(w.value.resultados,o=>(d(),R(e(z),{key:o.grupo_id},{default:s(()=>[t(e(k),{class:"font-medium"},{default:s(()=>[n(u(o.grupo_id||"Sin especificar"),1)]),_:2},1024),_.value==="municipio"?(d(),R(e(k),{key:0},{default:s(()=>[n(u(o.departamento_id||"N/A"),1)]),_:2},1024)):v("",!0),t(e(k),{class:"text-right"},{default:s(()=>[n(u(o.total_votos),1)]),_:2},1024),t(e(k),{class:"text-right"},{default:s(()=>[t(e(G),{variant:"secondary"},{default:s(()=>[n(u(o.porcentaje)+"%",1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),l("div",ut," Total de votos analizados: "+u(w.value.total_votos),1)])):v("",!0)]),_:1})]),_:1})]),_:1}),t(e(U),{value:"tokens",class:"space-y-4"},{default:s(()=>[t(e(B),null,{default:s(()=>[t(e(F),null,{default:s(()=>[l("div",ct,[t(e(L),null,{default:s(()=>a[17]||(a[17]=[n("Tokens de Verificación Pública")])),_:1}),l("div",ft,[t(e(ge),{modelValue:$.value,"onUpdate:modelValue":a[1]||(a[1]=o=>$.value=o),placeholder:"Buscar token...",class:"w-64",onKeyup:ie(O,["enter"])},null,8,["modelValue"]),t(e(D),{onClick:O,variant:"outline"},{default:s(()=>a[18]||(a[18]=[n(" Buscar ")])),_:1})])])]),_:1}),t(e(A),null,{default:s(()=>[T.value?(d(),c("div",_t," Cargando tokens... ")):i.value?(d(),c("div",mt,[l("div",pt,[t(e(K),null,{default:s(()=>[t(e(Q),null,{default:s(()=>[t(e(z),null,{default:s(()=>[t(e(y),null,{default:s(()=>a[19]||(a[19]=[n("Token")])),_:1}),t(e(y),null,{default:s(()=>a[20]||(a[20]=[n("Fecha de Voto")])),_:1}),t(e(y),{class:"text-right"},{default:s(()=>a[21]||(a[21]=[n("Acción")])),_:1})]),_:1})]),_:1}),t(e(Z),null,{default:s(()=>[(d(!0),c(C,null,j(i.value.tokens,o=>(d(),R(e(z),{key:o.id},{default:s(()=>[t(e(k),{class:"font-mono text-xs"},{default:s(()=>[n(u(o.token_unico.substring(0,40))+"... ",1)]),_:2},1024),t(e(k),null,{default:s(()=>[n(u(I(o.created_at)),1)]),_:2},1024),t(e(k),{class:"text-right"},{default:s(()=>[t(e(D),{onClick:b=>te(o.token_unico),size:"sm",variant:"outline"},{default:s(()=>[t(e(Be),{class:"mr-2 h-3 w-3"}),a[22]||(a[22]=n(" Verificar "))]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),i.value.pagination&&i.value.pagination.last_page>1?(d(),c("div",vt,[l("p",gt," Página "+u(i.value.pagination.current_page)+" de "+u(i.value.pagination.last_page)+" ("+u(i.value.pagination.total)+" tokens total) ",1),l("div",bt,[t(e(D),{onClick:a[2]||(a[2]=o=>{p.value--,P()}),disabled:i.value.pagination.current_page<=1,size:"sm",variant:"outline"},{default:s(()=>a[23]||(a[23]=[n(" Anterior ")])),_:1},8,["disabled"]),t(e(D),{onClick:a[3]||(a[3]=o=>{p.value++,P()}),disabled:i.value.pagination.current_page>=i.value.pagination.last_page,size:"sm",variant:"outline"},{default:s(()=>a[24]||(a[24]=[n(" Siguiente ")])),_:1},8,["disabled"])])])):v("",!0)])):v("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1},8,["breadcrumbs"])],64))}});export{St as default};
