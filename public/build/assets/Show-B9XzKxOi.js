import{T as W,S as J,j as X,k as G,l as K,_ as Q}from"./AppLayout.vue_vue_type_script_setup_true_lang-CyoQlVBv.js";import{d as Y,k as Z,j as $,o as d,e as a,b as t,f as n,u as e,m as ee,t as i,g as o,n as te,P as k,a as u,i as j,F as D,r as E,W as R}from"./app-7LlKm78u.js";import{_ as x}from"./createLucideIcon-C3Ab61m5.js";import{_,a as p,b as g,c}from"./index-Cmp74z6d.js";import{_ as T}from"./CardDescription.vue_vue_type_script_setup_true_lang-CiKhemwU.js";import{e as b,U as se,C as ae}from"./DialogTitle.vue_vue_type_script_setup_true_lang-B5BWniUE.js";import{_ as le,a as ne,b as N,c as h,d as oe,e as w}from"./TableHeader.vue_vue_type_script_setup_true_lang-4AxO5XkK.js";import{_ as ie,a as re,b as S,c as C}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-CBeIuRfb.js";import{_ as de}from"./ScrollArea.vue_vue_type_script_setup_true_lang-B9V6ZNYB.js";import{R as ue}from"./refresh-cw-CoUWasME.js";import{T as me}from"./trash-Cg7-Y4aH.js";import{S as fe}from"./square-pen-avcIrZfD.js";import{A as _e}from"./arrow-left-Mds2BBut.js";import{H as pe}from"./hash-uXoEw-4x.js";import{M as ge}from"./mail-Bvblb_N7.js";import{U as ce}from"./user-DvDj7gu6.js";import"./Label.vue_vue_type_script_setup_true_lang-CNdlZ2bU.js";import"./index-BLTdg2QY.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Cne8tvjX.js";import"./VisuallyHidden-BQiVCHMw.js";import"./RovingFocusItem-DNo-Fgu5.js";const ve={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},xe={class:"flex items-center justify-between"},ye={class:"flex items-center gap-4"},be={class:"p-3 bg-primary/10 rounded-lg"},he={class:"text-2xl font-bold tracking-tight"},we={class:"flex items-center gap-2 mt-1"},$e={class:"flex gap-2"},ke={class:"grid gap-6 md:grid-cols-4"},Se={class:"text-2xl font-bold"},Ce={class:"text-2xl font-bold"},je={class:"text-sm font-bold"},De={class:"text-2xl font-bold"},Ee={class:"flex items-center gap-3"},Te={class:"font-medium"},Ue={class:"flex items-center gap-1"},Ae={class:"text-sm"},Re={key:1,class:"text-center py-8 text-muted-foreground"},Ne={key:2,class:"mt-4 text-sm text-muted-foreground text-center"},Ve={key:0},Fe={class:"space-y-4"},Le={class:"flex items-center justify-between"},Me={class:"font-semibold"},Pe={class:"text-sm text-muted-foreground"},ze={key:1,class:"text-center py-8 text-muted-foreground"},Be={key:0,class:"space-y-3"},qe={class:"font-semibold"},Ie={class:"text-sm text-muted-foreground"},Oe={key:1,class:"text-center py-8 text-muted-foreground"},He={class:"grid grid-cols-2 gap-4"},We={class:"text-sm font-mono"},Je={class:"text-sm font-mono"},Xe={class:"text-sm"},Ge={class:"text-sm"},Ke={class:"text-sm"},Qe={key:0},Ye={class:"text-sm"},bt=Y({__name:"Show",props:{segment:{},users:{},metadata:{},isPaginated:{type:Boolean}},setup(V){const v=V,F=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Segmentos",href:"/admin/segments"},{title:v.segment.name,href:"#"}],y=Z(!1),L=l=>l.split(" ").map(s=>s[0]).join("").toUpperCase().slice(0,2),M=l=>new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),U=l=>new Date(l).toLocaleString("es-ES"),P=l=>l<60?`${l} segundos`:l<3600?`${Math.floor(l/60)} minutos`:`${Math.floor(l/3600)} horas`,z=l=>l.split("\\").pop()||l,B=l=>l!=null&&l.last_calculated_at?new Date(l.last_calculated_at).toLocaleString():"Nunca",q=async()=>{var l;y.value=!0;try{(await(await fetch(`/admin/segments/${v.segment.id}/evaluate`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content"))||""}})).json()).success&&R.reload()}catch(s){console.error("Error evaluating segment:",s)}finally{y.value=!1}},I=()=>{R.post(`/admin/segments/${v.segment.id}/clear-cache`)},A=()=>v.isPaginated?v.users:{data:v.users},O=l=>Array.isArray(l)?l.join(", "):typeof l=="object"&&l!==null?JSON.stringify(l):String(l),H=l=>{if(!l||typeof l!="object")return[];const s=[];for(const[r,m]of Object.entries(l))m!=null&&s.push({field:r,value:m});return s};return(l,s)=>(d(),$(Q,{breadcrumbs:F},{default:a(()=>[t(e(ee),{title:`Segmento: ${l.segment.name}`},null,8,["title"]),n("div",ve,[n("div",xe,[n("div",ye,[n("div",be,[t(e(W),{class:"h-8 w-8 text-primary"})]),n("div",null,[n("h2",he,i(l.segment.name),1),n("div",we,[t(e(b),{variant:l.segment.is_dynamic?"default":"secondary"},{default:a(()=>[o(i(l.segment.is_dynamic?"Dinámico":"Estático"),1)]),_:1},8,["variant"]),t(e(b),{variant:"outline"},{default:a(()=>[o(i(z(l.segment.model_type)),1)]),_:1})])])]),n("div",$e,[t(e(x),{onClick:q,variant:"secondary",disabled:y.value},{default:a(()=>[t(e(ue),{class:te(["mr-2 h-4 w-4",{"animate-spin":y.value}])},null,8,["class"]),o(" "+i(y.value?"Evaluando...":"Recalcular"),1)]),_:1},8,["disabled"]),t(e(x),{onClick:I,variant:"ghost"},{default:a(()=>[t(e(me),{class:"mr-2 h-4 w-4"}),s[0]||(s[0]=o(" Limpiar Cache "))]),_:1}),t(e(k),{href:`/admin/segments/${l.segment.id}/edit`},{default:a(()=>[t(e(x),null,{default:a(()=>[t(e(fe),{class:"mr-2 h-4 w-4"}),s[1]||(s[1]=o(" Editar "))]),_:1})]),_:1},8,["href"]),t(e(k),{href:l.route("admin.segments.index")},{default:a(()=>[t(e(x),{variant:"outline"},{default:a(()=>[t(e(_e),{class:"mr-2 h-4 w-4"}),s[2]||(s[2]=o(" Volver "))]),_:1})]),_:1},8,["href"])])]),n("div",ke,[t(e(_),null,{default:a(()=>[t(e(p),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[t(e(g),{class:"text-sm font-medium"},{default:a(()=>s[3]||(s[3]=[o("Usuarios Totales")])),_:1}),t(e(se),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(e(c),null,{default:a(()=>{var r;return[n("div",Se,i(((r=l.metadata)==null?void 0:r.contacts_count)||0),1),s[4]||(s[4]=n("p",{class:"text-xs text-muted-foreground"},"usuarios en este segmento",-1))]}),_:1})]),_:1}),t(e(_),null,{default:a(()=>[t(e(p),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[t(e(g),{class:"text-sm font-medium"},{default:a(()=>s[5]||(s[5]=[o("Cache")])),_:1}),t(e(J),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(e(c),null,{default:a(()=>[n("div",Ce,i(P(l.segment.cache_duration)),1),s[6]||(s[6]=n("p",{class:"text-xs text-muted-foreground"},"duración del cache",-1))]),_:1})]),_:1}),t(e(_),null,{default:a(()=>[t(e(p),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[t(e(g),{class:"text-sm font-medium"},{default:a(()=>s[7]||(s[7]=[o("Última Evaluación")])),_:1}),t(e(ae),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(e(c),null,{default:a(()=>[n("div",je,i(B(l.metadata)),1),s[8]||(s[8]=n("p",{class:"text-xs text-muted-foreground"},"última actualización",-1))]),_:1})]),_:1}),t(e(_),null,{default:a(()=>[t(e(p),{class:"flex flex-row items-center justify-between space-y-0 pb-2"},{default:a(()=>[t(e(g),{class:"text-sm font-medium"},{default:a(()=>s[9]||(s[9]=[o("Roles")])),_:1}),t(e(pe),{class:"h-4 w-4 text-muted-foreground"})]),_:1}),t(e(c),null,{default:a(()=>{var r;return[n("div",De,i(((r=l.segment.roles)==null?void 0:r.length)||0),1),s[10]||(s[10]=n("p",{class:"text-xs text-muted-foreground"},"roles asociados",-1))]}),_:1})]),_:1})]),t(e(ie),{defaultValue:"users",class:"space-y-4"},{default:a(()=>[t(e(re),null,{default:a(()=>[t(e(S),{value:"users"},{default:a(()=>s[11]||(s[11]=[o("Usuarios")])),_:1}),t(e(S),{value:"filters"},{default:a(()=>s[12]||(s[12]=[o("Filtros")])),_:1}),t(e(S),{value:"roles"},{default:a(()=>s[13]||(s[13]=[o("Roles")])),_:1}),t(e(S),{value:"details"},{default:a(()=>s[14]||(s[14]=[o("Detalles")])),_:1})]),_:1}),t(e(C),{value:"users"},{default:a(()=>[t(e(_),null,{default:a(()=>[t(e(p),null,{default:a(()=>[t(e(g),null,{default:a(()=>s[15]||(s[15]=[o("Usuarios en este Segmento")])),_:1}),t(e(T),null,{default:a(()=>s[16]||(s[16]=[o(" Lista de usuarios que cumplen con los criterios del segmento ")])),_:1})]),_:1}),t(e(c),null,{default:a(()=>{var r,m;return[(r=A().data)!=null&&r.length?(d(),$(e(le),{key:0},{default:a(()=>[t(e(ne),null,{default:a(()=>[t(e(N),null,{default:a(()=>[t(e(h),null,{default:a(()=>s[17]||(s[17]=[o("Usuario")])),_:1}),t(e(h),null,{default:a(()=>s[18]||(s[18]=[o("Email")])),_:1}),t(e(h),null,{default:a(()=>s[19]||(s[19]=[o("Estado")])),_:1}),t(e(h),null,{default:a(()=>s[20]||(s[20]=[o("Registro")])),_:1}),t(e(h),{class:"text-right"},{default:a(()=>s[21]||(s[21]=[o("Acciones")])),_:1})]),_:1})]),_:1}),t(e(oe),null,{default:a(()=>[(d(!0),u(D,null,E(A().data,f=>(d(),$(e(N),{key:f.id},{default:a(()=>[t(e(w),null,{default:a(()=>[n("div",Ee,[t(e(X),{class:"h-8 w-8"},{default:a(()=>[f.avatar?(d(),$(e(G),{key:0,src:f.avatar,alt:f.name},null,8,["src","alt"])):j("",!0),t(e(K),null,{default:a(()=>[o(i(L(f.name)),1)]),_:2},1024)]),_:2},1024),n("span",Te,i(f.name),1)])]),_:2},1024),t(e(w),null,{default:a(()=>[n("div",Ue,[t(e(ge),{class:"h-4 w-4 text-muted-foreground"}),n("span",Ae,i(f.email),1)])]),_:2},1024),t(e(w),null,{default:a(()=>[t(e(b),{variant:f.activo?"default":"secondary"},{default:a(()=>[o(i(f.activo?"Activo":"Inactivo"),1)]),_:2},1032,["variant"])]),_:2},1024),t(e(w),null,{default:a(()=>[o(i(M(f.created_at)),1)]),_:2},1024),t(e(w),{class:"text-right"},{default:a(()=>[t(e(k),{href:`/admin/users/${f.id}`},{default:a(()=>[t(e(x),{size:"sm",variant:"ghost"},{default:a(()=>[t(e(ce),{class:"mr-2 h-4 w-4"}),s[22]||(s[22]=o(" Ver Usuario "))]),_:1})]),_:2},1032,["href"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):(d(),u("div",Re," No hay usuarios en este segmento ")),l.isPaginated?(d(),u("div",Ne," Mostrando "+i((m=l.users.data)==null?void 0:m.length)+" de "+i(l.users.total)+" usuarios ",1)):j("",!0)]}),_:1})]),_:1})]),_:1}),t(e(C),{value:"filters"},{default:a(()=>[t(e(_),null,{default:a(()=>[t(e(p),null,{default:a(()=>[t(e(g),null,{default:a(()=>s[23]||(s[23]=[o("Criterios de Filtrado")])),_:1}),t(e(T),null,{default:a(()=>s[24]||(s[24]=[o(" Filtros aplicados para determinar los usuarios de este segmento ")])),_:1})]),_:1}),t(e(c),null,{default:a(()=>[l.segment.filters&&Object.keys(l.segment.filters).length>0?(d(),u("div",Ve,[t(e(de),{class:"h-[400px]"},{default:a(()=>[n("div",Fe,[(d(!0),u(D,null,E(H(l.segment.filters),r=>(d(),u("div",{key:r.field,class:"p-4 border rounded-lg"},[n("div",Le,[n("div",null,[n("p",Me,i(r.field),1),n("p",Pe,i(O(r.value)),1)]),t(e(b),{variant:"outline"},{default:a(()=>[o(i(typeof r.value=="object"?"Complejo":"Simple"),1)]),_:2},1024)])]))),128))])]),_:1})])):(d(),u("div",ze," No hay filtros definidos para este segmento "))]),_:1})]),_:1})]),_:1}),t(e(C),{value:"roles"},{default:a(()=>[t(e(_),null,{default:a(()=>[t(e(p),null,{default:a(()=>[t(e(g),null,{default:a(()=>s[25]||(s[25]=[o("Roles Asociados")])),_:1}),t(e(T),null,{default:a(()=>s[26]||(s[26]=[o(" Roles que utilizan este segmento para delimitar el alcance de datos ")])),_:1})]),_:1}),t(e(c),null,{default:a(()=>{var r;return[(r=l.segment.roles)!=null&&r.length?(d(),u("div",Be,[(d(!0),u(D,null,E(l.segment.roles,m=>(d(),u("div",{key:m.id,class:"flex items-center justify-between p-4 border rounded-lg"},[n("div",null,[n("h4",qe,i(m.display_name),1),n("p",Ie,i(m.name),1)]),t(e(k),{href:`/admin/roles/${m.id}`},{default:a(()=>[t(e(x),{size:"sm",variant:"ghost"},{default:a(()=>s[27]||(s[27]=[o(" Ver Rol ")])),_:1})]),_:2},1032,["href"])]))),128))])):(d(),u("div",Oe," No hay roles asociados a este segmento "))]}),_:1})]),_:1})]),_:1}),t(e(C),{value:"details"},{default:a(()=>[t(e(_),null,{default:a(()=>[t(e(p),null,{default:a(()=>[t(e(g),null,{default:a(()=>s[28]||(s[28]=[o("Información del Segmento")])),_:1})]),_:1}),t(e(c),{class:"space-y-4"},{default:a(()=>{var r;return[n("div",He,[n("div",null,[s[29]||(s[29]=n("p",{class:"text-sm font-medium text-muted-foreground"},"ID del Segmento",-1)),n("p",We,i(l.segment.id),1)]),n("div",null,[s[30]||(s[30]=n("p",{class:"text-sm font-medium text-muted-foreground"},"Tipo de Modelo",-1)),n("p",Je,i(l.segment.model_type),1)]),n("div",null,[s[31]||(s[31]=n("p",{class:"text-sm font-medium text-muted-foreground"},"Creado por",-1)),n("p",Xe,i(((r=l.segment.created_by)==null?void 0:r.name)||"Sistema"),1)]),n("div",null,[s[32]||(s[32]=n("p",{class:"text-sm font-medium text-muted-foreground"},"Tipo",-1)),t(e(b),{variant:l.segment.is_dynamic?"default":"secondary"},{default:a(()=>[o(i(l.segment.is_dynamic?"Dinámico":"Estático"),1)]),_:1},8,["variant"])]),n("div",null,[s[33]||(s[33]=n("p",{class:"text-sm font-medium text-muted-foreground"},"Creado",-1)),n("p",Ge,i(U(l.segment.created_at)),1)]),n("div",null,[s[34]||(s[34]=n("p",{class:"text-sm font-medium text-muted-foreground"},"Última Actualización",-1)),n("p",Ke,i(U(l.segment.updated_at)),1)])]),l.segment.description?(d(),u("div",Qe,[s[35]||(s[35]=n("p",{class:"text-sm font-medium text-muted-foreground mb-2"},"Descripción",-1)),n("p",Ye,i(l.segment.description),1)])):j("",!0)]}),_:1})]),_:1})]),_:1})]),_:1})])]),_:1}))}});export{bt as default};
