import{d as oe,C as te,k as g,c as w,w as N,p as se,J as re,a as b,o as u,b as t,f as s,u as e,m as ie,_ as le,j as c,i as f,e as i,g as d,t as p,F as j,r as ne,bK as ue,W as de}from"./app-DaeX7cdw.js";import{c as me,_ as z}from"./createLucideIcon-CjSnWMAs.js";import{c as F,_ as B,a as I,b as M,t as v,d as ce}from"./index-11KoE7K9.js";import{_ as P}from"./CardDescription.vue_vue_type_script_setup_true_lang-D2c5TVWn.js";import{_ as k,a as V}from"./Label.vue_vue_type_script_setup_true_lang-CMHm9R99.js";import{_ as q,a as R}from"./index-yxdRVCHg.js";import{e as fe,l as W}from"./DialogTitle.vue_vue_type_script_setup_true_lang-D_nilgK0.js";import{_ as pe}from"./Progress.vue_vue_type_script_setup_true_lang-Bkaeo_BW.js";import{D as ve}from"./DynamicFormRenderer-B7BqtDle.js";import{u as _e}from"./useAutoSave-CasIiw-I.js";import{L as G}from"./loader-circle-BUiClZo0.js";import{C as ge}from"./clock-DeWG7NZQ.js";import{S as be}from"./save-DZF9BgZ1.js";import{S as he}from"./send-iK3_R00P.js";import"./VisuallyHidden-Dq3uFg-l.js";import"./index-D0dABG5H.js";import"./Checkbox.vue_vue_type_script_setup_true_lang-ChzN2Ctw.js";import"./Textarea.vue_vue_type_script_setup_true_lang-Cnx2cgaS.js";import"./plus-BJOEnpvP.js";import"./user-Doll1slk.js";import"./RadioGroupItem.vue_vue_type_script_setup_true_lang-DOSfQbJp.js";import"./RovingFocusItem-DEx9p9eK.js";import"./VisuallyHiddenInput-B3mveJf9.js";import"./useConditionalFields-CcShiGwc.js";import"./upload-DUVKB5_L.js";import"./eye-C_jNXRru.js";import"./download-DY1DMKCt.js";import"./trash-2-EKkXpNpQ.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=me("CircleCheckIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ye={class:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50"},xe={class:"bg-white border-b"},we={class:"container mx-auto px-4 py-6"},ke={class:"max-w-4xl mx-auto"},Ve={class:"text-3xl font-bold text-gray-900"},Se={key:1,class:"text-gray-600 mt-2"},Ce={class:"container mx-auto px-4 py-8"},$e={class:"max-w-4xl mx-auto"},Fe={class:"flex items-center justify-between mb-2"},Be={class:"text-sm text-muted-foreground"},Ee={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},De={class:"flex items-center gap-2 text-green-600"},Le={class:"list-disc list-inside mt-2"},Te={class:"fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t shadow-lg z-50"},Ue={class:"container mx-auto px-4"},Ae={class:"max-w-4xl mx-auto py-4"},Ne={class:"flex items-center justify-between"},je={class:"flex items-center gap-4"},ze={key:0,class:"flex items-center gap-2 text-sm text-muted-foreground"},Ie={key:1,class:"flex items-center gap-2 text-sm text-green-600"},Me={class:"hidden md:flex items-center gap-2 text-sm text-muted-foreground"},Pe={class:"flex items-center gap-2"},qe=oe({__name:"Show",props:{formulario:{},respuestaBorrador:{},esVisitante:{type:Boolean}},setup(K){var U,A;const r=K,l=te({respuestas:((U=r.respuestaBorrador)==null?void 0:U.respuestas)||{},nombre_visitante:"",email_visitante:"",telefono_visitante:"",documento_visitante:"",captcha:""}),y=g((()=>{var a;const o={};return(a=r.respuestaBorrador)!=null&&a.respuestas&&Object.assign(o,r.respuestaBorrador.respuestas),r.formulario.configuracion_campos&&Array.isArray(r.formulario.configuracion_campos)&&r.formulario.configuracion_campos.forEach(n=>{if(!(n.id in o))switch(n.type){case"checkbox":o[n.id]=!1;break;case"number":o[n.id]=0;break;case"select":case"radio":o[n.id]="";break;default:o[n.id]=""}}),o})());g(0),w(()=>1);const S=w(()=>r.formulario.configuracion_campos&&Array.isArray(r.formulario.configuracion_campos)&&r.formulario.configuracion_campos.length>0),m=g(!1),J=g(!0),C=g(null),_=w(()=>{const o=r.formulario.configuracion_campos.length,a=Object.keys(l.respuestas).filter(n=>{const h=l.respuestas[n];return h!==null&&h!==""&&h!==void 0}).length;return o>0?Math.round(a/o*100):0}),{state:E,isSaving:x,hasSaved:D,saveNow:H,startWatching:$,stopWatching:L,clearLocalStorage:Q}=_e(y||g({}),{url:route("api.formularios.autosave"),resourceId:((A=r.respuestaBorrador)==null?void 0:A.id)||null,resourceIdField:"respuesta_id",debounceTime:3e3,showNotifications:!1,useLocalStorage:!0,localStorageKey:`formulario_${r.formulario.slug}_draft`,additionalData:{formulario_id:r.formulario.id}});N(y,o=>{o&&(l.respuestas=o)},{deep:!0}),N(()=>E.value.status,o=>{o==="saved"&&(C.value=E.value.lastSaved)}),se(()=>{r.esVisitante||$(),window.addEventListener("beforeunload",T)}),re(()=>{r.esVisitante||L(),window.removeEventListener("beforeunload",T)});const T=o=>{(x.value||_.value>0&&_.value<100)&&(o.preventDefault(),o.returnValue="¿Estás seguro de que quieres salir? Los cambios no guardados se perderán.")},X=()=>{const o=r.formulario.configuracion_campos||[];for(const a of o)if(a.required&&!l.respuestas[a.id])return v.error(`El campo "${a.title}" es requerido`),!1;if(r.esVisitante){if(!l.nombre_visitante||!l.email_visitante)return v.error("Por favor completa tu nombre y email"),!1;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email_visitante))return v.error("Por favor ingresa un email válido"),!1}return!0},Y=async()=>{if(X()){m.value=!0,r.esVisitante||L();try{const o={...l.data(),formulario_id:r.formulario.id};await de.post(route("formularios.store",r.formulario.slug),o,{preserveScroll:!0,onSuccess:()=>{Q(),v.success("Formulario enviado exitosamente")},onError:a=>{v.error("Error al enviar el formulario"),console.error(a),m.value=!1,r.esVisitante||$()}})}catch{v.error("Error inesperado al enviar el formulario"),m.value=!1,r.esVisitante||$()}}},Z=()=>{r.esVisitante||(H(),v.success("Borrador guardado"))},ee=w(()=>{if(!C.value)return"";const a=Math.floor((new Date().getTime()-C.value.getTime())/1e3);return a<60?"hace unos segundos":a<3600?`hace ${Math.floor(a/60)} minutos`:a<86400?`hace ${Math.floor(a/3600)} horas`:"hace más de un día"}),ae=o=>{y.value=o||{}};return(o,a)=>(u(),b(j,null,[t(e(ie),{title:o.formulario.titulo},null,8,["title"]),s("div",ye,[s("div",xe,[s("div",we,[s("div",ke,[o.formulario.categoria?(u(),c(e(fe),{key:0,class:"mb-2"},{default:i(()=>[d(p(o.formulario.categoria.nombre),1)]),_:1})):f("",!0),s("h1",Ve,p(o.formulario.titulo),1),o.formulario.descripcion?(u(),b("p",Se,p(o.formulario.descripcion),1)):f("",!0)])])]),s("div",Ce,[s("div",$e,[t(e(B),{class:"mb-6"},{default:i(()=>[t(e(F),{class:"py-4"},{default:i(()=>[s("div",Fe,[a[4]||(a[4]=s("span",{class:"text-sm font-medium"},"Progreso del formulario",-1)),s("span",Be,p(_.value)+"% completado",1)]),t(e(pe),{value:_.value,class:"h-2"},null,8,["value"])]),_:1})]),_:1}),o.esVisitante?(u(),c(e(B),{key:0,class:"mb-6"},{default:i(()=>[t(e(I),null,{default:i(()=>[t(e(M),null,{default:i(()=>a[5]||(a[5]=[d("Información de contacto")])),_:1}),t(e(P),null,{default:i(()=>a[6]||(a[6]=[d(" Por favor proporciona tus datos para poder contactarte ")])),_:1})]),_:1}),t(e(F),{class:"space-y-4"},{default:i(()=>[s("div",Ee,[s("div",null,[t(e(k),{htmlFor:"nombre"},{default:i(()=>a[7]||(a[7]=[d("Nombre completo *")])),_:1}),t(e(V),{id:"nombre",modelValue:e(l).nombre_visitante,"onUpdate:modelValue":a[0]||(a[0]=n=>e(l).nombre_visitante=n),placeholder:"Tu nombre completo",disabled:m.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(k),{htmlFor:"email"},{default:i(()=>a[8]||(a[8]=[d("Correo electrónico *")])),_:1}),t(e(V),{id:"email",type:"email",modelValue:e(l).email_visitante,"onUpdate:modelValue":a[1]||(a[1]=n=>e(l).email_visitante=n),placeholder:"tu@email.com",disabled:m.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(k),{htmlFor:"telefono"},{default:i(()=>a[9]||(a[9]=[d("Teléfono")])),_:1}),t(e(V),{id:"telefono",modelValue:e(l).telefono_visitante,"onUpdate:modelValue":a[2]||(a[2]=n=>e(l).telefono_visitante=n),placeholder:"Tu número de teléfono",disabled:m.value},null,8,["modelValue","disabled"])]),s("div",null,[t(e(k),{htmlFor:"documento"},{default:i(()=>a[10]||(a[10]=[d("Documento de identidad")])),_:1}),t(e(V),{id:"documento",modelValue:e(l).documento_visitante,"onUpdate:modelValue":a[3]||(a[3]=n=>e(l).documento_visitante=n),placeholder:"Tu número de documento",disabled:m.value},null,8,["modelValue","disabled"])])])]),_:1})]),_:1})):f("",!0),t(e(B),{class:"mb-20"},{default:i(()=>[t(e(I),null,{default:i(()=>[t(e(M),null,{default:i(()=>a[11]||(a[11]=[d("Completa el formulario")])),_:1}),!o.esVisitante&&e(D)?(u(),c(e(P),{key:0},{default:i(()=>[s("div",De,[t(e(O),{class:"h-4 w-4"}),d(" Autoguardado "+p(ee.value),1)])]),_:1})):f("",!0)]),_:1}),t(e(F),null,{default:i(()=>[S.value?f("",!0):(u(),c(e(q),{key:0,variant:"destructive",class:"mb-4"},{default:i(()=>[t(e(W),{class:"h-4 w-4"}),t(e(R),null,{default:i(()=>a[12]||(a[12]=[d(" Este formulario no tiene campos configurados. Por favor, contacta al administrador. ")])),_:1})]),_:1})),S.value?(u(),c(ve,{key:1,fields:o.formulario.configuracion_campos||[],"model-value":y.value||{},disabled:m.value,"onUpdate:modelValue":ae},null,8,["fields","model-value","disabled"])):f("",!0)]),_:1})]),_:1}),e(l).errors&&Object.keys(e(l).errors).length>0?(u(),c(e(q),{key:1,class:"mb-6",variant:"destructive"},{default:i(()=>[t(e(W),{class:"h-4 w-4"}),t(e(R),null,{default:i(()=>[s("ul",Le,[(u(!0),b(j,null,ne(e(l).errors,(n,h)=>(u(),b("li",{key:h},p(n),1))),128))])]),_:1})]),_:1})):f("",!0)])]),le(s("div",Te,[s("div",Ue,[s("div",Ae,[s("div",Ne,[s("div",je,[e(x)?(u(),b("div",ze,[t(e(G),{class:"h-4 w-4 animate-spin"}),a[13]||(a[13]=d(" Guardando... "))])):e(D)&&!o.esVisitante?(u(),b("div",Ie,[t(e(O),{class:"h-4 w-4"}),a[14]||(a[14]=d(" Guardado "))])):f("",!0),s("div",Me,[t(e(ge),{class:"h-4 w-4"}),d(" "+p(_.value)+"% completado ",1)])]),s("div",Pe,[o.esVisitante?f("",!0):(u(),c(e(z),{key:0,variant:"outline",size:"sm",onClick:Z,disabled:e(x)||m.value},{default:i(()=>[t(e(be),{class:"mr-2 h-4 w-4"}),a[15]||(a[15]=d(" Guardar borrador "))]),_:1},8,["disabled"])),t(e(z),{size:"sm",onClick:Y,disabled:m.value||e(x)||_.value===0||!S.value},{default:i(()=>[m.value?(u(),c(e(G),{key:1,class:"mr-2 h-4 w-4 animate-spin"})):(u(),c(e(he),{key:0,class:"mr-2 h-4 w-4"})),d(" "+p(m.value?"Enviando...":"Enviar formulario"),1)]),_:1},8,["disabled"])])])])])],512),[[ue,J.value]])])],64))}}),ba=ce(qe,[["__scopeId","data-v-6c404af8"]]);export{ba as default};
