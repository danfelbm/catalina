import{d as Z,C as K,c as x,w as ee,j as k,o as c,e as t,b as l,f as r,u as e,m as se,i as A,g as o,P as L,h as le,t as u,a as f,F as h,r as $,W as te}from"./app-C-ljWtfy.js";import{e as ie,T as ae,_ as oe}from"./AppLayout.vue_vue_type_script_setup_true_lang-DrR_52Cc.js";import{_ as g}from"./createLucideIcon-_oXcxsH_.js";import{_ as S,a as w,b as P,c as V}from"./index-C1n5YpSv.js";import{_ as U}from"./CardDescription.vue_vue_type_script_setup_true_lang-Dy74ld2R.js";import{_,a as M}from"./Label.vue_vue_type_script_setup_true_lang-BUmVMQfq.js";import{_ as ne}from"./Textarea.vue_vue_type_script_setup_true_lang-Dq6pp1kI.js";import{_ as j}from"./Checkbox.vue_vue_type_script_setup_true_lang-D7tWp4m1.js";import{l as re,U as de,e as O}from"./DialogTitle.vue_vue_type_script_setup_true_lang-Cap5hEl3.js";import{_ as me,a as ue,b as D,c as C}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-b7xwyLkR.js";import{_ as ce}from"./ScrollArea.vue_vue_type_script_setup_true_lang-aGJ5T0IY.js";import{_ as pe,a as fe}from"./index-Dnb-LG-z.js";import{_ as _e}from"./Switch.vue_vue_type_script_setup_true_lang-xg3G1wKA.js";import{_ as v}from"./InputError.vue_vue_type_script_setup_true_lang-DuWfpyDP.js";import{A as ve}from"./arrow-left-CpNmfABz.js";import{L as ge}from"./lock-DztiMuxR.js";import{S as be}from"./save-DnW2Ecqm.js";import"./index-BfIyhi4o.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DK8M-y8i.js";import"./VisuallyHidden-SZsN-sM_.js";import"./RovingFocusItem-CaM9lr2a.js";import"./VisuallyHiddenInput-BrgKv1qv.js";const xe={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ye={class:"flex items-center justify-between"},ke={class:"flex gap-2"},he={class:"space-y-2"},$e={class:"space-y-2"},Se={class:"space-y-2"},we={class:"space-y-2"},Pe={class:"flex items-center justify-between"},Ve={class:"space-y-0.5"},Ue={class:"text-xs text-muted-foreground"},je={class:"pt-4 border-t space-y-2 text-sm text-muted-foreground"},De={class:"flex gap-2 mt-4"},Ce={class:"space-y-6"},Ee={class:"flex items-center space-x-2 pb-2 border-b"},Ae={class:"grid grid-cols-2 gap-3 pl-6"},Re={class:"grid grid-cols-2 gap-4"},Le={key:0,class:"space-y-3"},Me={class:"flex-1"},Oe={class:"text-xs text-muted-foreground mt-1"},Fe={key:1,class:"text-center py-8 text-muted-foreground"},Ge={class:"flex justify-end gap-4"},ds=Z({__name:"Edit",props:{role:{},segments:{},availablePermissions:{},modules:{},selectedSegments:{}},setup(F){const d=F,G=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Roles y Permisos",href:"/admin/roles"},{title:"Editar Rol",href:"#"}],i=K({name:d.role.name,display_name:d.role.display_name,description:d.role.description||"",is_administrative:!!d.role.is_administrative,permissions:d.role.permissions||[],allowed_modules:d.role.allowed_modules||[],segment_ids:d.selectedSegments||[]}),y=x(()=>["super_admin","admin","manager","user","end_customer"].includes(d.role.name)),b=x(()=>i.is_administrative?d.availablePermissions.administrative:d.availablePermissions.frontend),N=x(()=>i.is_administrative?d.modules.administrative:d.modules.frontend),R=n=>{const s=b.value[n];return s?Object.keys(s.permissions).every(m=>i.permissions.includes(m)):!1},z=n=>{const s=b.value[n];if(!s)return!1;const a=Object.keys(s.permissions),m=a.filter(p=>i.permissions.includes(p)).length;return m>0&&m<a.length},B=n=>{const s=i.permissions.indexOf(n);s>-1?i.permissions.splice(s,1):i.permissions.push(n)},T=n=>{const s=b.value[n];if(!s)return;const a=Object.keys(s.permissions);R(n)?i.permissions=i.permissions.filter(p=>!a.includes(p)):a.forEach(p=>{i.permissions.includes(p)||i.permissions.push(p)})},q=n=>{const s=i.allowed_modules.indexOf(n);s>-1?i.allowed_modules.splice(s,1):i.allowed_modules.push(n)},W=n=>{const s=i.segment_ids.indexOf(n);s>-1?i.segment_ids.splice(s,1):i.segment_ids.push(n)},I=()=>{i.put(`/admin/roles/${d.role.id}`,{preserveScroll:!0,onSuccess:()=>{}})},H=()=>{confirm(`¿Estás seguro de eliminar el rol "${d.role.display_name}"? Esta acción no se puede deshacer.`)&&te.delete(`/admin/roles/${d.role.id}`)},J=()=>{const n=[];Object.values(b.value).forEach(s=>{Object.keys(s.permissions).forEach(a=>{n.push(a)})}),i.permissions=n},Q=()=>{i.permissions=[]};ee(()=>i.is_administrative,(n,s)=>{s!==void 0&&n!==s&&(i.permissions=[],i.allowed_modules=[])});const X=x(()=>i.permissions.length),Y=x(()=>!y.value);return(n,s)=>(c(),k(oe,{breadcrumbs:G},{default:t(()=>[l(e(se),{title:"Editar Rol"}),r("div",xe,[r("div",ye,[s[6]||(s[6]=r("div",null,[r("h2",{class:"text-2xl font-bold tracking-tight"},"Editar Rol"),r("p",{class:"text-muted-foreground"}," Modifica los permisos y configuración del rol ")],-1)),r("div",ke,[Y.value?(c(),k(e(g),{key:0,onClick:H,variant:"destructive",type:"button"},{default:t(()=>s[4]||(s[4]=[o(" Eliminar Rol ")])),_:1})):A("",!0),l(e(L),{href:n.route("admin.roles.index")},{default:t(()=>[l(e(g),{variant:"outline"},{default:t(()=>[l(e(ve),{class:"mr-2 h-4 w-4"}),s[5]||(s[5]=o(" Volver "))]),_:1})]),_:1},8,["href"])])]),y.value?(c(),k(e(pe),{key:0},{default:t(()=>[l(e(re),{class:"h-4 w-4"}),l(e(fe),null,{default:t(()=>s[7]||(s[7]=[o(" Este es un rol del sistema. Algunas configuraciones pueden estar restringidas. ")])),_:1})]),_:1})):A("",!0),r("form",{onSubmit:le(I,["prevent"]),class:"space-y-6"},[l(e(me),{defaultValue:"general",class:"space-y-4"},{default:t(()=>[l(e(ue),{class:"grid w-full grid-cols-4"},{default:t(()=>[l(e(D),{value:"general"},{default:t(()=>[l(e(ie),{class:"mr-2 h-4 w-4"}),s[8]||(s[8]=o(" General "))]),_:1}),l(e(D),{value:"permissions"},{default:t(()=>[l(e(ge),{class:"mr-2 h-4 w-4"}),s[9]||(s[9]=o(" Permisos "))]),_:1}),l(e(D),{value:"modules"},{default:t(()=>[l(e(de),{class:"mr-2 h-4 w-4"}),s[10]||(s[10]=o(" Módulos "))]),_:1}),l(e(D),{value:"segments"},{default:t(()=>[l(e(ae),{class:"mr-2 h-4 w-4"}),s[11]||(s[11]=o(" Segmentos "))]),_:1})]),_:1}),l(e(C),{value:"general"},{default:t(()=>[l(e(S),null,{default:t(()=>[l(e(w),null,{default:t(()=>[l(e(P),null,{default:t(()=>s[12]||(s[12]=[o("Información General")])),_:1}),l(e(U),null,{default:t(()=>s[13]||(s[13]=[o(" Define el nombre y descripción del rol ")])),_:1})]),_:1}),l(e(V),{class:"space-y-4"},{default:t(()=>[r("div",he,[l(e(_),{htmlFor:"name"},{default:t(()=>s[14]||(s[14]=[o("Nombre del Rol (interno)")])),_:1}),l(e(M),{id:"name",modelValue:e(i).name,"onUpdate:modelValue":s[0]||(s[0]=a=>e(i).name=a),placeholder:"ejemplo_rol",pattern:"[a-z_]+",title:"Solo letras minúsculas y guiones bajos",disabled:y.value},null,8,["modelValue","disabled"]),s[15]||(s[15]=r("p",{class:"text-xs text-muted-foreground"}," Use solo letras minúsculas y guiones bajos (ej: admin_regional) ",-1)),l(v,{message:e(i).errors.name},null,8,["message"])]),r("div",$e,[l(e(_),{htmlFor:"display_name"},{default:t(()=>s[16]||(s[16]=[o("Nombre a Mostrar")])),_:1}),l(e(M),{id:"display_name",modelValue:e(i).display_name,"onUpdate:modelValue":s[1]||(s[1]=a=>e(i).display_name=a),placeholder:"Administrador Regional"},null,8,["modelValue"]),l(v,{message:e(i).errors.display_name},null,8,["message"])]),r("div",Se,[l(e(_),{htmlFor:"description"},{default:t(()=>s[17]||(s[17]=[o("Descripción")])),_:1}),l(e(ne),{id:"description",modelValue:e(i).description,"onUpdate:modelValue":s[2]||(s[2]=a=>e(i).description=a),placeholder:"Describe las responsabilidades de este rol...",rows:"4"},null,8,["modelValue"]),l(v,{message:e(i).errors.description},null,8,["message"])]),r("div",we,[r("div",Pe,[r("div",Ve,[l(e(_),{htmlFor:"is_administrative"},{default:t(()=>s[18]||(s[18]=[o("Rol Administrativo")])),_:1}),s[19]||(s[19]=r("p",{class:"text-xs text-muted-foreground"}," Los roles administrativos tienen acceso al panel de administración. Los roles frontend son para usuarios regulares del sistema. ",-1))]),l(e(_e),{id:"is_administrative",modelValue:e(i).is_administrative,"onUpdate:modelValue":s[3]||(s[3]=a=>e(i).is_administrative=a),disabled:y.value},null,8,["modelValue","disabled"])]),l(v,{message:e(i).errors.is_administrative},null,8,["message"]),r("div",Ue," Debug: is_administrative = "+u(e(i).is_administrative)+" ("+u(typeof e(i).is_administrative)+") ",1)]),r("div",je,[r("p",null,"ID del Rol: "+u(n.role.id),1),r("p",null,"Creado: "+u(new Date(n.role.created_at).toLocaleDateString()),1),r("p",null,"Última actualización: "+u(new Date(n.role.updated_at).toLocaleDateString()),1)])]),_:1})]),_:1})]),_:1}),l(e(C),{value:"permissions"},{default:t(()=>[l(e(S),null,{default:t(()=>[l(e(w),null,{default:t(()=>[l(e(P),null,{default:t(()=>s[20]||(s[20]=[o("Matriz de Permisos")])),_:1}),l(e(U),null,{default:t(()=>[o(u(e(i).is_administrative?"Selecciona los permisos administrativos para este rol":"Selecciona los permisos de usuario para este rol"),1)]),_:1}),r("div",De,[l(e(g),{type:"button",size:"sm",variant:"outline",onClick:J},{default:t(()=>s[21]||(s[21]=[o(" Seleccionar Todos ")])),_:1}),l(e(g),{type:"button",size:"sm",variant:"outline",onClick:Q},{default:t(()=>s[22]||(s[22]=[o(" Limpiar Todos ")])),_:1}),l(e(O),{variant:"secondary",class:"ml-auto"},{default:t(()=>[o(u(X.value)+" permisos seleccionados ",1)]),_:1})])]),_:1}),l(e(V),null,{default:t(()=>[l(e(ce),{class:"h-[500px] pr-4"},{default:t(()=>[r("div",Ce,[(c(!0),f(h,null,$(b.value,(a,m)=>(c(),f("div",{key:m,class:"space-y-3"},[r("div",Ee,[l(e(j),{checked:R(m),indeterminate:z(m),"onUpdate:checked":p=>T(m)},null,8,["checked","indeterminate","onUpdate:checked"]),l(e(_),{class:"text-sm font-semibold"},{default:t(()=>[o(u(a.label),1)]),_:2},1024)]),r("div",Ae,[(c(!0),f(h,null,$(a.permissions,(p,E)=>(c(),f("div",{key:E,class:"flex items-center space-x-2"},[l(e(j),{checked:e(i).permissions.includes(E),"onUpdate:checked":Ne=>B(E)},null,8,["checked","onUpdate:checked"]),l(e(_),{class:"text-sm font-normal cursor-pointer"},{default:t(()=>[o(u(p),1)]),_:2},1024)]))),128))])]))),128))])]),_:1}),l(v,{message:e(i).errors.permissions},null,8,["message"])]),_:1})]),_:1})]),_:1}),l(e(C),{value:"modules"},{default:t(()=>[l(e(S),null,{default:t(()=>[l(e(w),null,{default:t(()=>[l(e(P),null,{default:t(()=>s[23]||(s[23]=[o("Módulos Permitidos")])),_:1}),l(e(U),null,{default:t(()=>[o(u(e(i).is_administrative?"Selecciona los módulos administrativos a los que tendrá acceso este rol":"Selecciona los módulos del portal público a los que tendrá acceso este rol"),1)]),_:1})]),_:1}),l(e(V),null,{default:t(()=>[r("div",Re,[(c(!0),f(h,null,$(N.value,(a,m)=>(c(),f("div",{key:m,class:"flex items-center space-x-2"},[l(e(j),{checked:e(i).allowed_modules.includes(m),"onUpdate:checked":p=>q(m)},null,8,["checked","onUpdate:checked"]),l(e(_),{class:"text-sm font-normal cursor-pointer"},{default:t(()=>[o(u(a),1)]),_:2},1024)]))),128))]),l(v,{message:e(i).errors.allowed_modules},null,8,["message"])]),_:1})]),_:1})]),_:1}),l(e(C),{value:"segments"},{default:t(()=>[l(e(S),null,{default:t(()=>[l(e(w),null,{default:t(()=>[l(e(P),null,{default:t(()=>s[24]||(s[24]=[o("Segmentos de Datos")])),_:1}),l(e(U),null,{default:t(()=>s[25]||(s[25]=[o(" Asocia segmentos para limitar el alcance de datos visibles ")])),_:1})]),_:1}),l(e(V),null,{default:t(()=>[n.segments.length>0?(c(),f("div",Le,[(c(!0),f(h,null,$(n.segments,a=>(c(),f("div",{key:a.id,class:"flex items-start space-x-3 p-3 border rounded-lg hover:bg-muted/50"},[l(e(j),{checked:e(i).segment_ids.includes(a.id),"onUpdate:checked":m=>W(a.id),class:"mt-1"},null,8,["checked","onUpdate:checked"]),r("div",Me,[l(e(_),{class:"text-sm font-medium cursor-pointer"},{default:t(()=>[o(u(a.name),1)]),_:2},1024),r("p",Oe,u(a.description||"Sin descripción"),1),a.user_count?(c(),k(e(O),{key:0,variant:"outline",class:"mt-2"},{default:t(()=>[o(u(a.user_count)+" usuarios ",1)]),_:2},1024)):A("",!0)])]))),128))])):(c(),f("div",Fe," No hay segmentos disponibles ")),l(v,{message:e(i).errors.segment_ids},null,8,["message"])]),_:1})]),_:1})]),_:1})]),_:1}),r("div",Ge,[l(e(L),{href:n.route("admin.roles.index")},{default:t(()=>[l(e(g),{type:"button",variant:"outline"},{default:t(()=>s[26]||(s[26]=[o(" Cancelar ")])),_:1})]),_:1},8,["href"]),l(e(g),{type:"submit",disabled:e(i).processing},{default:t(()=>[l(e(be),{class:"mr-2 h-4 w-4"}),o(" "+u(e(i).processing?"Guardando...":"Guardar Cambios"),1)]),_:1},8,["disabled"])])],32)])]),_:1}))}});export{ds as default};
