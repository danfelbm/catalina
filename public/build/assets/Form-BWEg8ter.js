import{d as ae,c as _,k as g,C as re,w as oe,p as te,a as u,o as c,b as t,u as a,m as ie,e as s,f as l,t as n,g as d,h as se,i as f,n as v,F,r as G,j as R}from"./app-C-ljWtfy.js";import{_ as U}from"./createLucideIcon-_oXcxsH_.js";import{_ as le,a as ne,b as de,c as ce}from"./index-C1n5YpSv.js";import{_ as ue}from"./Checkbox.vue_vue_type_script_setup_true_lang-D7tWp4m1.js";import{_ as m,a as fe}from"./Label.vue_vue_type_script_setup_true_lang-BUmVMQfq.js";import{_ as T,a as A,b as j,c as P,d as x,C as H,U as me}from"./DialogTitle.vue_vue_type_script_setup_true_lang-Cap5hEl3.js";import{_ as _e,a as pe,b as O,c as J}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-b7xwyLkR.js";import{_ as ve}from"./Textarea.vue_vue_type_script_setup_true_lang-Dq6pp1kI.js";import{_ as K}from"./DateTimePicker.vue_vue_type_script_setup_true_lang-CWXTiidW.js";import{a as he,_ as ge}from"./DynamicFormBuilder.vue_vue_type_script_setup_true_lang-CHLO-i4i.js";import{a as be,S as xe,_ as ye}from"./AppLayout.vue_vue_type_script_setup_true_lang-DrR_52Cc.js";import{A as Ce}from"./arrow-left-CpNmfABz.js";import{C as $e}from"./clock-Cb6qrYV_.js";import"./index-BfIyhi4o.js";import"./VisuallyHidden-SZsN-sM_.js";import"./RovingFocusItem-CaM9lr2a.js";import"./plus-CEd_Yrfl.js";import"./grip-vertical-DfJmJyer.js";import"./trash-2-BEi92pnC.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-Dy74ld2R.js";import"./eye-C1Tj_mCC.js";import"./git-branch-CzDWUEJT.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DK8M-y8i.js";const we={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},Ve={class:"flex items-center justify-between"},De={class:"text-3xl font-bold"},ke={class:"text-muted-foreground"},Ee={class:"grid gap-6 md:grid-cols-2"},Ne={class:"space-y-4"},Se={key:0,class:"text-sm text-destructive mt-1"},Fe={key:0,class:"text-sm text-destructive mt-1"},Ue={key:0,class:"text-sm text-destructive mt-1"},Te={class:"flex items-center space-x-2"},Ae={class:"space-y-4"},je={key:0,class:"text-sm text-destructive mt-1"},Pe={key:1,class:"text-sm text-destructive mt-1"},Me={key:0,class:"text-sm text-destructive mt-1"},qe={key:1,class:"text-sm text-destructive mt-1"},Be={key:2,class:"text-sm text-destructive mt-1"},Ie={key:0,class:"text-sm text-destructive mt-1"},Le={key:0,class:"text-sm text-destructive mt-1"},ze={key:0,class:"p-4 bg-blue-50 rounded-lg border border-blue-200"},Ge={class:"mt-2 space-y-2"},Re={class:"flex items-center gap-2 text-blue-700"},He={class:"font-medium"},Oe={class:"font-medium"},Je={key:0,class:"flex items-center gap-2 text-blue-600"},Ke={key:1,class:"flex items-center gap-2 text-blue-600"},Qe={key:2,class:"flex items-center gap-2 text-blue-600"},We={key:0,class:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg"},Xe={class:"text-red-800 text-sm"},Ye={class:"flex justify-between mt-8"},$a=ae({__name:"Form",props:{convocatoria:{}},setup(Q){const y=Q,p=_(()=>!!y.convocatoria),W=[{title:"Admin",href:"/admin/dashboard"},{title:"Convocatorias",href:"/admin/convocatorias"},{title:p.value?"Editar":"Crear",href:"#"}],M=g("general"),D=g([]),C=g([]),k=g(!1),E=g(!1),e=re((()=>{if(!y.convocatoria)return{nombre:"",descripcion:"",fecha_apertura:null,fecha_cierre:null,cargo_id:null,periodo_electoral_id:null,territorio_id:null,departamento_id:null,municipio_id:null,localidad_id:null,formulario_postulacion:[],estado:"borrador",activo:!0};const o=y.convocatoria;return{nombre:o.nombre||"",descripcion:o.descripcion||"",fecha_apertura:o.fecha_apertura?new Date(o.fecha_apertura):null,fecha_cierre:o.fecha_cierre?new Date(o.fecha_cierre):null,cargo_id:o.cargo_id||null,periodo_electoral_id:o.periodo_electoral_id||null,territorio_id:o.territorio_id||null,departamento_id:o.departamento_id||null,municipio_id:o.municipio_id||null,localidad_id:o.localidad_id||null,formulario_postulacion:o.formulario_postulacion||[],estado:o.estado||"borrador",activo:o.activo}})()),N=g({territorios_ids:e.territorio_id?[e.territorio_id]:[],departamentos_ids:e.departamento_id?[e.departamento_id]:[],municipios_ids:e.municipio_id?[e.municipio_id]:[],localidades_ids:e.localidad_id?[e.localidad_id]:[]});oe(N,o=>{e.territorio_id=o.territorios_ids[0]||null,e.departamento_id=o.departamentos_ids[0]||null,e.municipio_id=o.municipios_ids[0]||null,e.localidad_id=o.localidades_ids[0]||null},{deep:!0}),te(async()=>{await Promise.all([X(),Y()])});const X=async()=>{try{k.value=!0;const o=await fetch("/admin/cargos-for-convocatorias");D.value=await o.json()}catch(o){console.error("Error loading cargos:",o)}finally{k.value=!1}},Y=async()=>{try{E.value=!0;const o=await fetch("/admin/periodos-disponibles");C.value=await o.json()}catch(o){console.error("Error loading periodos:",o)}finally{E.value=!1}},Z=()=>{p.value?e.put(`/admin/convocatorias/${y.convocatoria.id}`,{onError:o=>{console.error("Errores de validación:",o)}}):e.post("/admin/convocatorias",{onError:o=>{console.error("Errores de validación:",o)}})},$=_(()=>{if(!e.fecha_apertura)return"";const o=e.fecha_apertura instanceof Date?e.fecha_apertura:new Date(e.fecha_apertura);return isNaN(o.getTime())?"Fecha de apertura inválida":""}),w=_(()=>{if(!e.fecha_cierre||!e.fecha_apertura)return"";const o=e.fecha_apertura instanceof Date?e.fecha_apertura:new Date(e.fecha_apertura),r=e.fecha_cierre instanceof Date?e.fecha_cierre:new Date(e.fecha_cierre);return isNaN(o.getTime())||isNaN(r.getTime())?"Fechas inválidas":r<=o?"La fecha de cierre debe ser posterior a la fecha de apertura":""}),S=_(()=>{if(!e.fecha_apertura||!e.fecha_cierre||!e.periodo_electoral_id)return"";const o=C.value.find(V=>V.id===e.periodo_electoral_id);if(!o)return"";const r=e.fecha_apertura instanceof Date?e.fecha_apertura:new Date(e.fecha_apertura),i=e.fecha_cierre instanceof Date?e.fecha_cierre:new Date(e.fecha_cierre),b=new Date(o.fecha_inicio),h=new Date(o.fecha_fin);return r<b||r>h||i<b||i>h?"Las fechas deben estar dentro del periodo electoral seleccionado":""}),q=_(()=>{if(!e.fecha_apertura||!e.fecha_cierre)return"";const o=e.fecha_apertura instanceof Date?e.fecha_apertura:new Date(e.fecha_apertura),r=e.fecha_cierre instanceof Date?e.fecha_cierre:new Date(e.fecha_cierre);if(isNaN(o.getTime())||isNaN(r.getTime()))return"";const i=Math.ceil((r.getTime()-o.getTime())/(1e3*60*60*24));if(i<0)return"";if(i<1){const z=Math.ceil((r.getTime()-o.getTime())/36e5);return`${z} hora${z!==1?"s":""}`}if(i<30)return`${i} día${i!==1?"s":""}`;const b=Math.floor(i/30),h=i%30;let V=`${b} mes${b!==1?"es":""}`;return h>0&&(V+=` y ${h} día${h!==1?"s":""}`),V}),ee=_(()=>e.nombre.trim().length>0&&e.fecha_apertura&&e.fecha_cierre&&e.cargo_id&&e.periodo_electoral_id&&!$.value&&!w.value&&!S.value),B=o=>{if(!o)return"";const r=o instanceof Date?o:new Date(o);return isNaN(r.getTime())?"":r.toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},I=_(()=>e.cargo_id?D.value.find(o=>o.id===e.cargo_id):null),L=_(()=>e.periodo_electoral_id?C.value.find(o=>o.id===e.periodo_electoral_id):null);return(o,r)=>(c(),u(F,null,[t(a(ie),{title:p.value?"Editar Convocatoria":"Nueva Convocatoria"},null,8,["title"]),t(ye,{breadcrumbs:W},{default:s(()=>[l("div",we,[l("div",Ve,[l("div",null,[l("h1",De,n(p.value?"Editar Convocatoria":"Nueva Convocatoria"),1),l("p",ke,n(p.value?"Modifica los datos de la convocatoria electoral":"Crea una nueva convocatoria con formulario de postulación personalizado"),1)]),t(a(U),{variant:"outline",onClick:r[0]||(r[0]=i=>o.$inertia.visit("/admin/convocatorias"))},{default:s(()=>[t(a(Ce),{class:"mr-2 h-4 w-4"}),r[13]||(r[13]=d(" Volver "))]),_:1})]),t(a(le),null,{default:s(()=>[t(a(ne),null,{default:s(()=>[t(a(de),null,{default:s(()=>[d(n(p.value?"Datos de la Convocatoria":"Información de la Nueva Convocatoria"),1)]),_:1})]),_:1}),t(a(ce),null,{default:s(()=>[l("form",{onSubmit:se(Z,["prevent"])},[t(a(_e),{modelValue:M.value,"onUpdate:modelValue":r[11]||(r[11]=i=>M.value=i),class:"w-full"},{default:s(()=>[t(a(pe),{class:"grid w-full grid-cols-2"},{default:s(()=>[t(a(O),{value:"general",class:"flex items-center gap-2"},{default:s(()=>[t(a(be),{class:"h-4 w-4"}),r[14]||(r[14]=d(" Información General "))]),_:1}),t(a(O),{value:"formulario",class:"flex items-center gap-2"},{default:s(()=>[t(a(xe),{class:"h-4 w-4"}),r[15]||(r[15]=d(" Formulario de Postulación "))]),_:1})]),_:1}),t(a(J),{value:"general",class:"space-y-6"},{default:s(()=>[l("div",Ee,[l("div",Ne,[l("div",null,[t(a(m),{for:"nombre"},{default:s(()=>r[16]||(r[16]=[d("Nombre de la Convocatoria *")])),_:1}),t(a(fe),{id:"nombre",modelValue:a(e).nombre,"onUpdate:modelValue":r[1]||(r[1]=i=>a(e).nombre=i),placeholder:"Ej: Elección Alcalde 2024, Postulación Senado...",class:v({"border-destructive":a(e).errors.nombre})},null,8,["modelValue","class"]),a(e).errors.nombre?(c(),u("p",Se,n(a(e).errors.nombre),1)):f("",!0)]),l("div",null,[t(a(m),{for:"descripcion"},{default:s(()=>r[17]||(r[17]=[d("Descripción (opcional)")])),_:1}),t(a(ve),{id:"descripcion",modelValue:a(e).descripcion,"onUpdate:modelValue":r[2]||(r[2]=i=>a(e).descripcion=i),placeholder:"Descripción detallada de la convocatoria...",rows:"4",class:v({"border-destructive":a(e).errors.descripcion})},null,8,["modelValue","class"]),a(e).errors.descripcion?(c(),u("p",Fe,n(a(e).errors.descripcion),1)):f("",!0)]),l("div",null,[t(a(m),{for:"estado"},{default:s(()=>r[18]||(r[18]=[d("Estado *")])),_:1}),t(a(T),{modelValue:a(e).estado,"onUpdate:modelValue":r[3]||(r[3]=i=>a(e).estado=i)},{default:s(()=>[t(a(A),{class:v({"border-destructive":a(e).errors.estado})},{default:s(()=>[t(a(j),{placeholder:"Seleccionar estado"})]),_:1},8,["class"]),t(a(P),null,{default:s(()=>[t(a(x),{value:"borrador"},{default:s(()=>r[19]||(r[19]=[d("Borrador")])),_:1}),t(a(x),{value:"activa"},{default:s(()=>r[20]||(r[20]=[d("Activa")])),_:1}),t(a(x),{value:"cerrada"},{default:s(()=>r[21]||(r[21]=[d("Cerrada")])),_:1})]),_:1})]),_:1},8,["modelValue"]),a(e).errors.estado?(c(),u("p",Ue,n(a(e).errors.estado),1)):f("",!0)]),l("div",Te,[t(a(ue),{id:"activo",checked:a(e).activo,"onUpdate:checked":r[4]||(r[4]=i=>a(e).activo=i)},null,8,["checked"]),t(a(m),{for:"activo"},{default:s(()=>r[22]||(r[22]=[d(" Convocatoria activa ")])),_:1})]),r[23]||(r[23]=l("p",{class:"text-xs text-muted-foreground"}," Solo las convocatorias activas pueden recibir postulaciones. ",-1))]),l("div",Ae,[l("div",null,[t(a(m),{for:"fecha_apertura"},{default:s(()=>r[24]||(r[24]=[d("Fecha y Hora de Apertura *")])),_:1}),t(a(K),{id:"fecha_apertura",modelValue:a(e).fecha_apertura,"onUpdate:modelValue":r[5]||(r[5]=i=>a(e).fecha_apertura=i),placeholder:"Seleccionar fecha y hora de apertura",class:v({"border-destructive":a(e).errors.fecha_apertura||$.value})},null,8,["modelValue","class"]),$.value?(c(),u("p",je,n($.value),1)):f("",!0),a(e).errors.fecha_apertura?(c(),u("p",Pe,n(a(e).errors.fecha_apertura),1)):f("",!0)]),l("div",null,[t(a(m),{for:"fecha_cierre"},{default:s(()=>r[25]||(r[25]=[d("Fecha y Hora de Cierre *")])),_:1}),t(a(K),{id:"fecha_cierre",modelValue:a(e).fecha_cierre,"onUpdate:modelValue":r[6]||(r[6]=i=>a(e).fecha_cierre=i),placeholder:"Seleccionar fecha y hora de cierre",class:v({"border-destructive":a(e).errors.fecha_cierre||w.value})},null,8,["modelValue","class"]),w.value?(c(),u("p",Me,n(w.value),1)):f("",!0),a(e).errors.fecha_cierre?(c(),u("p",qe,n(a(e).errors.fecha_cierre),1)):f("",!0),S.value?(c(),u("p",Be,n(S.value),1)):f("",!0)]),l("div",null,[t(a(m),{for:"cargo_id"},{default:s(()=>r[26]||(r[26]=[d("Cargo *")])),_:1}),t(a(T),{modelValue:a(e).cargo_id,"onUpdate:modelValue":r[7]||(r[7]=i=>a(e).cargo_id=i)},{default:s(()=>[t(a(A),{class:v({"border-destructive":a(e).errors.cargo_id})},{default:s(()=>[t(a(j),{placeholder:k.value?"Cargando cargos...":"Seleccionar cargo"},null,8,["placeholder"])]),_:1},8,["class"]),t(a(P),null,{default:s(()=>[(c(!0),u(F,null,G(D.value,i=>(c(),R(a(x),{key:i.id,value:i.id},{default:s(()=>[d(n(i.ruta_jerarquica),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),a(e).errors.cargo_id?(c(),u("p",Ie,n(a(e).errors.cargo_id),1)):f("",!0)]),l("div",null,[t(a(m),{for:"periodo_electoral_id"},{default:s(()=>r[27]||(r[27]=[d("Periodo Electoral *")])),_:1}),t(a(T),{modelValue:a(e).periodo_electoral_id,"onUpdate:modelValue":r[8]||(r[8]=i=>a(e).periodo_electoral_id=i)},{default:s(()=>[t(a(A),{class:v({"border-destructive":a(e).errors.periodo_electoral_id})},{default:s(()=>[t(a(j),{placeholder:E.value?"Cargando periodos...":"Seleccionar periodo"},null,8,["placeholder"])]),_:1},8,["class"]),t(a(P),null,{default:s(()=>[(c(!0),u(F,null,G(C.value,i=>(c(),R(a(x),{key:i.id,value:i.id},{default:s(()=>[d(n(i.nombre)+" ("+n(i.estado_label)+") ",1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"]),a(e).errors.periodo_electoral_id?(c(),u("p",Le,n(a(e).errors.periodo_electoral_id),1)):f("",!0)])])]),t(he,{modelValue:N.value,"onUpdate:modelValue":r[9]||(r[9]=i=>N.value=i),title:"Restricciones Geográficas (Opcional)",description:"Define las regiones donde estará disponible esta convocatoria. Si no seleccionas nada, estará disponible nacionalmente."},null,8,["modelValue"]),a(e).fecha_apertura&&a(e).fecha_cierre?(c(),u("div",ze,[t(a(m),{class:"text-blue-800 font-medium"},{default:s(()=>r[28]||(r[28]=[d("Vista previa de la convocatoria:")])),_:1}),l("div",Ge,[l("div",Re,[t(a(H),{class:"h-4 w-4"}),l("span",He,n(B(a(e).fecha_apertura)),1),r[29]||(r[29]=l("span",{class:"text-blue-500"},"→",-1)),l("span",Oe,n(B(a(e).fecha_cierre)),1)]),q.value?(c(),u("div",Je,[t(a($e),{class:"h-4 w-4"}),l("span",null,"Duración: "+n(q.value),1)])):f("",!0),I.value?(c(),u("div",Ke,[t(a(me),{class:"h-4 w-4"}),l("span",null,"Cargo: "+n(I.value.ruta_jerarquica),1)])):f("",!0),L.value?(c(),u("div",Qe,[t(a(H),{class:"h-4 w-4"}),l("span",null,"Periodo: "+n(L.value.nombre),1)])):f("",!0)])])):f("",!0)]),_:1}),t(a(J),{value:"formulario",class:"space-y-6"},{default:s(()=>[t(ge,{modelValue:a(e).formulario_postulacion,"onUpdate:modelValue":r[10]||(r[10]=i=>a(e).formulario_postulacion=i),title:"Formulario de Postulación",description:"Define los campos que deberán completar los postulantes. Estos campos se mostrarán además de la información básica requerida."},null,8,["modelValue"]),r[30]||(r[30]=l("div",{class:"p-4 bg-yellow-50 rounded-lg border border-yellow-200"},[l("p",{class:"text-yellow-800 text-sm"},[l("strong",null,"Nota:"),d(' En el futuro, aquí también podrás agregar un campo especial "Perfil de Candidatura" que permitirá a los usuarios vincular sus perfiles de candidatura aprobados a sus postulaciones. ')])],-1))]),_:1})]),_:1},8,["modelValue"]),a(e).errors.delete?(c(),u("div",We,[l("p",Xe,n(a(e).errors.delete),1)])):f("",!0),l("div",Ye,[t(a(U),{variant:"outline",type:"button",onClick:r[12]||(r[12]=i=>o.$inertia.visit("/admin/convocatorias"))},{default:s(()=>r[31]||(r[31]=[d(" Cancelar ")])),_:1}),t(a(U),{type:"submit",disabled:a(e).processing||!ee.value},{default:s(()=>[d(n(a(e).processing?"Guardando...":p.value?"Actualizar":"Crear")+" Convocatoria ",1)]),_:1},8,["disabled"])])],32)]),_:1})]),_:1})])]),_:1})],64))}});export{$a as default};
