import{d as Q,C as W,k as X,c as j,w as Y,j as N,o as m,e as t,b as l,f as r,u as e,m as Z,P as O,g as a,h as K,t as c,a as f,F as x,r as y,i as ee}from"./app-C-ljWtfy.js";import{e as se,T as le,_ as te}from"./AppLayout.vue_vue_type_script_setup_true_lang-DrR_52Cc.js";import{_ as g}from"./createLucideIcon-_oXcxsH_.js";import{_ as k,a as h,b as $,c as w}from"./index-C1n5YpSv.js";import{_ as S}from"./CardDescription.vue_vue_type_script_setup_true_lang-Dy74ld2R.js";import{_ as p,a as R}from"./Label.vue_vue_type_script_setup_true_lang-BUmVMQfq.js";import{_ as ie}from"./Textarea.vue_vue_type_script_setup_true_lang-Dq6pp1kI.js";import{_ as P}from"./Checkbox.vue_vue_type_script_setup_true_lang-D7tWp4m1.js";import{U as oe,e as D}from"./DialogTitle.vue_vue_type_script_setup_true_lang-Cap5hEl3.js";import{_ as ae,a as ne,b as V,c as C}from"./TabsTrigger.vue_vue_type_script_setup_true_lang-b7xwyLkR.js";import{_ as re}from"./ScrollArea.vue_vue_type_script_setup_true_lang-aGJ5T0IY.js";import{_ as de}from"./Switch.vue_vue_type_script_setup_true_lang-xg3G1wKA.js";import{_}from"./InputError.vue_vue_type_script_setup_true_lang-DuWfpyDP.js";import{A as me}from"./arrow-left-CpNmfABz.js";import{L as ue}from"./lock-DztiMuxR.js";import{S as ce}from"./save-DnW2Ecqm.js";import"./index-BfIyhi4o.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DK8M-y8i.js";import"./VisuallyHidden-SZsN-sM_.js";import"./RovingFocusItem-CaM9lr2a.js";import"./VisuallyHiddenInput-BrgKv1qv.js";const fe={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},pe={class:"flex items-center justify-between"},_e={class:"space-y-2"},ve={class:"space-y-2"},ge={class:"space-y-2"},be={class:"space-y-2"},xe={class:"flex items-center justify-between"},ye={class:"space-y-0.5"},ke={class:"flex gap-2 mt-4"},he={class:"space-y-6"},$e={class:"flex items-center space-x-2 pb-2 border-b"},we={class:"grid grid-cols-2 gap-3 pl-6"},Se={class:"grid grid-cols-2 gap-4"},Pe={key:0,class:"space-y-3"},Ve={class:"flex-1"},Ce={class:"text-xs text-muted-foreground mt-1"},Ue={key:1,class:"text-center py-8 text-muted-foreground"},je={class:"flex justify-end gap-4"},Ke=Q({__name:"Create",props:{segments:{},availablePermissions:{},modules:{}},setup(F){const b=F,L=[{title:"Dashboard",href:"/dashboard"},{title:"Administración",href:"#"},{title:"Roles y Permisos",href:"/admin/roles"},{title:"Crear Rol",href:"#"}],i=W({name:"",display_name:"",description:"",is_administrative:!0,permissions:[],allowed_modules:[],segment_ids:[]});X({});const v=j(()=>i.is_administrative?b.availablePermissions.administrative:b.availablePermissions.frontend),M=j(()=>i.is_administrative?b.modules.administrative:b.modules.frontend),A=n=>{const s=v.value[n];return s?Object.keys(s.permissions).every(d=>i.permissions.includes(d)):!1},G=n=>{const s=v.value[n];if(!s)return!1;const o=Object.keys(s.permissions),d=o.filter(u=>i.permissions.includes(u)).length;return d>0&&d<o.length},T=n=>{const s=i.permissions.indexOf(n);s>-1?i.permissions.splice(s,1):i.permissions.push(n)},z=n=>{const s=v.value[n];if(!s)return;const o=Object.keys(s.permissions);A(n)?i.permissions=i.permissions.filter(u=>!o.includes(u)):o.forEach(u=>{i.permissions.includes(u)||i.permissions.push(u)})},B=n=>{const s=i.allowed_modules.indexOf(n);s>-1?i.allowed_modules.splice(s,1):i.allowed_modules.push(n)},E=n=>{const s=i.segment_ids.indexOf(n);s>-1?i.segment_ids.splice(s,1):i.segment_ids.push(n)},q=()=>{i.post("/admin/roles",{preserveScroll:!0,onSuccess:()=>{}})},H=()=>{const n=[];Object.values(v.value).forEach(s=>{Object.keys(s.permissions).forEach(o=>{n.push(o)})}),i.permissions=n},I=()=>{i.permissions=[]};Y(()=>i.is_administrative,(n,s)=>{s!==void 0&&n!==s&&(i.permissions=[],i.allowed_modules=[])});const J=j(()=>i.permissions.length);return(n,s)=>(m(),N(te,{breadcrumbs:L},{default:t(()=>[l(e(Z),{title:"Crear Rol"}),r("div",fe,[r("div",pe,[s[5]||(s[5]=r("div",null,[r("h2",{class:"text-2xl font-bold tracking-tight"},"Crear Nuevo Rol"),r("p",{class:"text-muted-foreground"}," Define un nuevo rol con permisos específicos ")],-1)),l(e(O),{href:n.route("admin.roles.index")},{default:t(()=>[l(e(g),{variant:"outline"},{default:t(()=>[l(e(me),{class:"mr-2 h-4 w-4"}),s[4]||(s[4]=a(" Volver "))]),_:1})]),_:1},8,["href"])]),r("form",{onSubmit:K(q,["prevent"]),class:"space-y-6"},[l(e(ae),{defaultValue:"general",class:"space-y-4"},{default:t(()=>[l(e(ne),{class:"grid w-full grid-cols-4"},{default:t(()=>[l(e(V),{value:"general"},{default:t(()=>[l(e(se),{class:"mr-2 h-4 w-4"}),s[6]||(s[6]=a(" General "))]),_:1}),l(e(V),{value:"permissions"},{default:t(()=>[l(e(ue),{class:"mr-2 h-4 w-4"}),s[7]||(s[7]=a(" Permisos "))]),_:1}),l(e(V),{value:"modules"},{default:t(()=>[l(e(oe),{class:"mr-2 h-4 w-4"}),s[8]||(s[8]=a(" Módulos "))]),_:1}),l(e(V),{value:"segments"},{default:t(()=>[l(e(le),{class:"mr-2 h-4 w-4"}),s[9]||(s[9]=a(" Segmentos "))]),_:1})]),_:1}),l(e(C),{value:"general"},{default:t(()=>[l(e(k),null,{default:t(()=>[l(e(h),null,{default:t(()=>[l(e($),null,{default:t(()=>s[10]||(s[10]=[a("Información General")])),_:1}),l(e(S),null,{default:t(()=>s[11]||(s[11]=[a(" Define el nombre y descripción del rol ")])),_:1})]),_:1}),l(e(w),{class:"space-y-4"},{default:t(()=>[r("div",_e,[l(e(p),{htmlFor:"name"},{default:t(()=>s[12]||(s[12]=[a("Nombre del Rol (interno)")])),_:1}),l(e(R),{id:"name",modelValue:e(i).name,"onUpdate:modelValue":s[0]||(s[0]=o=>e(i).name=o),placeholder:"ejemplo_rol",pattern:"[a-z_]+",title:"Solo letras minúsculas y guiones bajos"},null,8,["modelValue"]),s[13]||(s[13]=r("p",{class:"text-xs text-muted-foreground"}," Use solo letras minúsculas y guiones bajos (ej: admin_regional) ",-1)),l(_,{message:e(i).errors.name},null,8,["message"])]),r("div",ve,[l(e(p),{htmlFor:"display_name"},{default:t(()=>s[14]||(s[14]=[a("Nombre a Mostrar")])),_:1}),l(e(R),{id:"display_name",modelValue:e(i).display_name,"onUpdate:modelValue":s[1]||(s[1]=o=>e(i).display_name=o),placeholder:"Administrador Regional"},null,8,["modelValue"]),l(_,{message:e(i).errors.display_name},null,8,["message"])]),r("div",ge,[l(e(p),{htmlFor:"description"},{default:t(()=>s[15]||(s[15]=[a("Descripción")])),_:1}),l(e(ie),{id:"description",modelValue:e(i).description,"onUpdate:modelValue":s[2]||(s[2]=o=>e(i).description=o),placeholder:"Describe las responsabilidades de este rol...",rows:"4"},null,8,["modelValue"]),l(_,{message:e(i).errors.description},null,8,["message"])]),r("div",be,[r("div",xe,[r("div",ye,[l(e(p),{htmlFor:"is_administrative"},{default:t(()=>s[16]||(s[16]=[a("Rol Administrativo")])),_:1}),s[17]||(s[17]=r("p",{class:"text-xs text-muted-foreground"}," Los roles administrativos tienen acceso al panel de administración. Los roles frontend son para usuarios regulares del sistema. ",-1))]),l(e(de),{id:"is_administrative",modelValue:e(i).is_administrative,"onUpdate:modelValue":s[3]||(s[3]=o=>e(i).is_administrative=o)},null,8,["modelValue"])]),l(_,{message:e(i).errors.is_administrative},null,8,["message"])])]),_:1})]),_:1})]),_:1}),l(e(C),{value:"permissions"},{default:t(()=>[l(e(k),null,{default:t(()=>[l(e(h),null,{default:t(()=>[l(e($),null,{default:t(()=>s[18]||(s[18]=[a("Matriz de Permisos")])),_:1}),l(e(S),null,{default:t(()=>[a(c(e(i).is_administrative?"Selecciona los permisos administrativos para este rol":"Selecciona los permisos de usuario para este rol"),1)]),_:1}),r("div",ke,[l(e(g),{type:"button",size:"sm",variant:"outline",onClick:H},{default:t(()=>s[19]||(s[19]=[a(" Seleccionar Todos ")])),_:1}),l(e(g),{type:"button",size:"sm",variant:"outline",onClick:I},{default:t(()=>s[20]||(s[20]=[a(" Limpiar Todos ")])),_:1}),l(e(D),{variant:"secondary",class:"ml-auto"},{default:t(()=>[a(c(J.value)+" permisos seleccionados ",1)]),_:1})])]),_:1}),l(e(w),null,{default:t(()=>[l(e(re),{class:"h-[500px] pr-4"},{default:t(()=>[r("div",he,[(m(!0),f(x,null,y(v.value,(o,d)=>(m(),f("div",{key:d,class:"space-y-3"},[r("div",$e,[l(e(P),{checked:A(d),indeterminate:G(d),"onUpdate:checked":u=>z(d)},null,8,["checked","indeterminate","onUpdate:checked"]),l(e(p),{class:"text-sm font-semibold"},{default:t(()=>[a(c(o.label),1)]),_:2},1024)]),r("div",we,[(m(!0),f(x,null,y(o.permissions,(u,U)=>(m(),f("div",{key:U,class:"flex items-center space-x-2"},[l(e(P),{checked:e(i).permissions.includes(U),"onUpdate:checked":Ae=>T(U)},null,8,["checked","onUpdate:checked"]),l(e(p),{class:"text-sm font-normal cursor-pointer"},{default:t(()=>[a(c(u),1)]),_:2},1024)]))),128))])]))),128))])]),_:1}),l(_,{message:e(i).errors.permissions},null,8,["message"])]),_:1})]),_:1})]),_:1}),l(e(C),{value:"modules"},{default:t(()=>[l(e(k),null,{default:t(()=>[l(e(h),null,{default:t(()=>[l(e($),null,{default:t(()=>s[21]||(s[21]=[a("Módulos Permitidos")])),_:1}),l(e(S),null,{default:t(()=>[a(c(e(i).is_administrative?"Selecciona los módulos administrativos a los que tendrá acceso este rol":"Selecciona los módulos del portal público a los que tendrá acceso este rol"),1)]),_:1})]),_:1}),l(e(w),null,{default:t(()=>[r("div",Se,[(m(!0),f(x,null,y(M.value,(o,d)=>(m(),f("div",{key:d,class:"flex items-center space-x-2"},[l(e(P),{checked:e(i).allowed_modules.includes(d),"onUpdate:checked":u=>B(d)},null,8,["checked","onUpdate:checked"]),l(e(p),{class:"text-sm font-normal cursor-pointer"},{default:t(()=>[a(c(o),1)]),_:2},1024)]))),128))]),l(_,{message:e(i).errors.allowed_modules},null,8,["message"])]),_:1})]),_:1})]),_:1}),l(e(C),{value:"segments"},{default:t(()=>[l(e(k),null,{default:t(()=>[l(e(h),null,{default:t(()=>[l(e($),null,{default:t(()=>s[22]||(s[22]=[a("Segmentos de Datos")])),_:1}),l(e(S),null,{default:t(()=>s[23]||(s[23]=[a(" Asocia segmentos para limitar el alcance de datos visibles ")])),_:1})]),_:1}),l(e(w),null,{default:t(()=>[n.segments.length>0?(m(),f("div",Pe,[(m(!0),f(x,null,y(n.segments,o=>(m(),f("div",{key:o.id,class:"flex items-start space-x-3 p-3 border rounded-lg hover:bg-muted/50"},[l(e(P),{checked:e(i).segment_ids.includes(o.id),"onUpdate:checked":d=>E(o.id),class:"mt-1"},null,8,["checked","onUpdate:checked"]),r("div",Ve,[l(e(p),{class:"text-sm font-medium cursor-pointer"},{default:t(()=>[a(c(o.name),1)]),_:2},1024),r("p",Ce,c(o.description||"Sin descripción"),1),o.user_count?(m(),N(e(D),{key:0,variant:"outline",class:"mt-2"},{default:t(()=>[a(c(o.user_count)+" usuarios ",1)]),_:2},1024)):ee("",!0)])]))),128))])):(m(),f("div",Ue," No hay segmentos disponibles ")),l(_,{message:e(i).errors.segment_ids},null,8,["message"])]),_:1})]),_:1})]),_:1})]),_:1}),r("div",je,[l(e(O),{href:n.route("admin.roles.index")},{default:t(()=>[l(e(g),{type:"button",variant:"outline"},{default:t(()=>s[24]||(s[24]=[a(" Cancelar ")])),_:1})]),_:1},8,["href"]),l(e(g),{type:"submit",disabled:e(i).processing},{default:t(()=>[l(e(ce),{class:"mr-2 h-4 w-4"}),a(" "+c(e(i).processing?"Creando...":"Crear Rol"),1)]),_:1},8,["disabled"])])],32)])]),_:1}))}});export{Ke as default};
