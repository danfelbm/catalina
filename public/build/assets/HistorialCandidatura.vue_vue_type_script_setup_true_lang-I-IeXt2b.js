import{d as S,k as g,c as A,p as q,a as l,o as r,F as v,b as o,u as s,e as i,g as m,r as x,f as e,t as n,i as _,j as $,n as E,h as U,l as L}from"./app-7LlKm78u.js";import{f as O,g as X,h as I,e as j,i as J,m as T}from"./DialogTitle.vue_vue_type_script_setup_true_lang-B5BWniUE.js";import{_ as k}from"./createLucideIcon-C3Ab61m5.js";import{_ as W,a as G,b as K,c as P}from"./index-Cmp74z6d.js";import{o as Q,q as Y,C as Z,p as aa}from"./AppLayout.vue_vue_type_script_setup_true_lang-CyoQlVBv.js";import{_ as M}from"./Skeleton.vue_vue_type_script_setup_true_lang-X6ANwPVk.js";import{C as D}from"./clock-BnjXW5pn.js";import{U as ea}from"./user-DvDj7gu6.js";import{E as V}from"./eye-mFpk8ekn.js";const ta={key:0,class:"space-y-3"},sa={class:"space-y-2 flex-1"},oa={key:1,class:"text-center py-8"},ra={class:"text-red-600 mb-4"},la={key:2,class:"text-center py-8"},ia={key:3,class:"space-y-4"},na={class:"flex items-center gap-3 flex-1 overflow-hidden"},da={class:"flex-shrink-0"},ca={class:"flex-1 min-w-0 overflow-hidden"},ua={class:"font-medium text-gray-900 dark:text-gray-100 line-clamp-1"},ma={class:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mt-1"},_a={class:"flex items-center gap-2"},fa={class:"mt-4 pt-4 border-t border-gray-100 dark:border-gray-700"},ga={key:0,class:"mb-3"},va={class:"text-sm text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 p-2 rounded line-clamp-2"},pa={key:1,class:"mb-3"},ya={class:"text-sm text-gray-600 dark:text-gray-400 bg-blue-50 dark:bg-blue-950/20 p-2 rounded border border-blue-200 dark:border-blue-800"},xa={class:"flex gap-2"},ka={key:0,class:"flex justify-center mt-6"},ba={class:"flex gap-2"},ha={key:0,class:"space-y-6"},wa={class:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg"},Ca={class:"grid grid-cols-2 gap-4 text-sm"},$a={class:"text-gray-600 dark:text-gray-400"},Ea={class:"text-gray-600 dark:text-gray-400"},ja={key:0,class:"col-span-2"},Ma={class:"text-gray-600 dark:text-gray-400 break-words"},Na={key:1},Aa={class:"text-gray-600 dark:text-gray-400"},Da={class:"space-y-4"},Va={class:"font-medium text-gray-700 dark:text-gray-300 mb-2"},Ba={class:"bg-gray-50 dark:bg-gray-800 p-3 rounded text-sm"},Ha={class:"whitespace-pre-wrap text-gray-800 dark:text-gray-200"},za={key:0,class:"text-center py-4"},Ja=S({__name:"HistorialCandidatura",props:{candidaturaId:{},versionActual:{},isAdmin:{type:Boolean,default:!1}},setup(B){const b=B,h=g(!0),p=g(null),u=g(null),y=g(new Set),d=g(null),w=g(!1),H=A(()=>u.value&&u.value.data.length>0),z=A(()=>u.value?u.value.data:[]),C=async(c=1)=>{try{h.value=!0,p.value=null;const a=b.isAdmin?`/admin/candidaturas/${b.candidaturaId}/historial?page=${c}`:`/candidaturas/${b.candidaturaId}/historial?page=${c}`,t=await fetch(a,{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(!t.ok)throw new Error("Error al cargar el historial");u.value=await t.json()}catch(a){p.value=a instanceof Error?a.message:"Error desconocido",console.error("Error cargando historial:",a)}finally{h.value=!1}},F=c=>{y.value.has(c)?y.value.delete(c):y.value.add(c)},N=c=>{d.value=c,w.value=!0},R=(c,a)=>a==null?"No especificado":Array.isArray(a)?a.join(", "):typeof a=="object"?JSON.stringify(a,null,2):String(a);return q(()=>{C()}),(c,a)=>(r(),l(v,null,[o(s(W),null,{default:i(()=>[o(s(G),null,{default:i(()=>[o(s(K),{class:"flex items-center gap-2"},{default:i(()=>[o(s(D),{class:"h-5 w-5"}),a[2]||(a[2]=m(" Historial de Cambios "))]),_:1})]),_:1}),o(s(P),null,{default:i(()=>[h.value?(r(),l("div",ta,[(r(),l(v,null,x(3,t=>e("div",{key:t,class:"flex items-center space-x-3"},[o(s(M),{class:"h-10 w-10 rounded-full"}),e("div",sa,[o(s(M),{class:"h-4 w-3/4"}),o(s(M),{class:"h-3 w-1/2"})])])),64))])):p.value?(r(),l("div",oa,[e("p",ra,n(p.value),1),o(s(k),{onClick:a[0]||(a[0]=t=>C()),variant:"outline"},{default:i(()=>a[3]||(a[3]=[m(" Reintentar ")])),_:1})])):H.value?(r(),l("div",ia,[(r(!0),l(v,null,x(z.value,t=>(r(),l("div",{key:t.id,class:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors"},[o(s(Q),null,{default:i(()=>[o(s(Y),{class:"flex items-center justify-between w-full text-left",onClick:f=>F(t.id)},{default:i(()=>[e("div",na,[e("div",da,[o(s(j),{class:E(t.estado_color)},{default:i(()=>[m(" v"+n(t.version),1)]),_:2},1032,["class"])]),e("div",ca,[e("p",ua,n(t.resumen_cambios),1),e("div",ma,[o(s(ea),{class:"h-3 w-3"}),e("span",null,n(t.created_by),1),a[6]||(a[6]=e("span",null,"•",-1)),e("span",null,n(t.fecha_formateada),1),a[7]||(a[7]=e("span",null,"•",-1)),o(s(j),{variant:"outline",class:E(t.estado_color)},{default:i(()=>[m(n(t.estado_label),1)]),_:2},1032,["class"])])])]),e("div",_a,[o(s(k),{onClick:U(f=>N(t),["stop"]),variant:"ghost",size:"sm"},{default:i(()=>[o(s(V),{class:"h-4 w-4"})]),_:2},1032,["onClick"]),(r(),$(L(y.value.has(t.id)?s(T):s(Z)),{class:"h-4 w-4 text-gray-400 dark:text-gray-600"}))])]),_:2},1032,["onClick"]),o(s(aa),null,{default:i(()=>[e("div",fa,[t.motivo_cambio?(r(),l("div",ga,[a[8]||(a[8]=e("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Motivo del cambio:",-1)),e("p",va,n(t.motivo_cambio),1)])):_("",!0),t.comentarios_admin_en_momento?(r(),l("div",pa,[a[9]||(a[9]=e("p",{class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"Comentarios de la comisión:",-1)),e("p",ya,n(t.comentarios_admin_en_momento),1)])):_("",!0),e("div",xa,[o(s(k),{onClick:f=>N(t),variant:"outline",size:"sm"},{default:i(()=>[o(s(V),{class:"h-4 w-4 mr-2"}),a[10]||(a[10]=m(" Ver formulario completo "))]),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1024)]))),128)),u.value&&u.value.last_page>1?(r(),l("div",ka,[e("div",ba,[(r(!0),l(v,null,x(u.value.last_page,t=>(r(),$(s(k),{key:t,onClick:f=>C(t),variant:t===u.value.current_page?"default":"outline",size:"sm"},{default:i(()=>[m(n(t),1)]),_:2},1032,["onClick","variant"]))),128))])])):_("",!0)])):(r(),l("div",la,[o(s(D),{class:"h-12 w-12 mx-auto text-gray-400 dark:text-gray-600 mb-4"}),a[4]||(a[4]=e("p",{class:"text-gray-600 dark:text-gray-400 mb-2"},"No hay historial disponible",-1)),a[5]||(a[5]=e("p",{class:"text-sm text-gray-500 dark:text-gray-500"}," El historial se creará automáticamente cuando realices cambios a tu candidatura. ",-1))]))]),_:1})]),_:1}),o(s(O),{open:w.value,"onUpdate:open":a[1]||(a[1]=t=>w.value=t)},{default:i(()=>[o(s(X),{class:"max-w-4xl max-h-[80vh] overflow-y-auto"},{default:i(()=>[o(s(I),null,{default:i(()=>[d.value?(r(),$(s(J),{key:0},{default:i(()=>[m(" Formulario - Versión "+n(d.value.version)+" ",1),o(s(j),{class:E([d.value.estado_color,"ml-2"])},{default:i(()=>[m(n(d.value.estado_label),1)]),_:1},8,["class"])]),_:1})):_("",!0)]),_:1}),d.value?(r(),l("div",ha,[e("div",wa,[e("div",Ca,[e("div",null,[a[11]||(a[11]=e("p",{class:"font-medium text-gray-700 dark:text-gray-300"},"Fecha del cambio:",-1)),e("p",$a,n(d.value.fecha_formateada),1)]),e("div",null,[a[12]||(a[12]=e("p",{class:"font-medium text-gray-700 dark:text-gray-300"},"Modificado por:",-1)),e("p",Ea,n(d.value.created_by),1)]),d.value.motivo_cambio?(r(),l("div",ja,[a[13]||(a[13]=e("p",{class:"font-medium text-gray-700 dark:text-gray-300"},"Motivo:",-1)),e("p",Ma,n(d.value.motivo_cambio),1)])):_("",!0),d.value.comentarios_admin_en_momento?(r(),l("div",Na,[a[14]||(a[14]=e("p",{class:"font-medium text-gray-700 dark:text-gray-300"},"Comentarios de la comisión:",-1)),e("p",Aa,n(d.value.comentarios_admin_en_momento),1)])):_("",!0)])]),e("div",null,[a[16]||(a[16]=e("h4",{class:"font-medium text-gray-900 dark:text-gray-100 mb-4"},"Datos del formulario en esta versión:",-1)),e("div",Da,[(r(!0),l(v,null,x(d.value.formulario_data_con_nombres,(t,f)=>(r(),l("div",{key:f,class:"border border-gray-200 dark:border-gray-700 rounded-lg p-3"},[e("p",Va,n(f),1),e("div",Ba,[e("pre",Ha,n(R(f,t)),1)])]))),128)),Object.keys(d.value.formulario_data_con_nombres||{}).length===0?(r(),l("div",za,a[15]||(a[15]=[e("p",{class:"text-gray-500 dark:text-gray-500"},"No hay datos de formulario disponibles para esta versión.",-1)]))):_("",!0)])])])):_("",!0)]),_:1})]),_:1},8,["open"])],64))}});export{Ja as _};
